<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>BGP on 小易的部落格</title><link>https://blog.steveyi.net/tags/bgp/</link><description>小易的部落格 (BGP)</description><generator>Hugo -- gohugo.io</generator><language>tw</language><lastBuildDate>Sun, 27 Jun 2021 05:35:35 +0800</lastBuildDate><atom:link href="https://blog.steveyi.net/tags/bgp/index.xml" rel="self" type="application/rss+xml"/><item><title>利用 AS-SET 建立過濾器</title><link>https://blog.steveyi.net/posts/using-as-set-to-make-filter/</link><pubDate>Sun, 27 Jun 2021 05:35:35 +0800</pubDate><guid>https://blog.steveyi.net/posts/using-as-set-to-make-filter/</guid><description>&lt;p>最近，為了跟一些新入坑的朋友們建立 BGP Peer，所以也順便來教他們怎麼使用 AS-SET 過濾。&lt;/p>
&lt;h3 id="什麼是-as-set" >什麼是 AS-SET
&lt;span>
&lt;a href="#%e4%bb%80%e9%ba%bc%e6%98%af-as-set">
&lt;svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg">&lt;path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;/svg>
&lt;/a>
&lt;/span>
&lt;/h3>&lt;p>AS-SET 是一個可以新增 ASN 及 AS-SET 的 Object。&lt;br>
通常用於過濾透過 BGP 協議所交換的路由。（如 BGP Peer Neighbor、Internet Exchange Route Server 等）&lt;/p>
&lt;p>我們通常透過 Whois 及遞迴的方式，來查詢這個 AS-SET 中的所有 Route Object。&lt;/p>
&lt;p>舉例來說，我們今天要透過 AS-STEVEYI 對某一個 BGP Peer 進行過濾。&lt;br>
首先，先透過 whois 查詢這個 AS-SET 中有哪些 ASN，然後我們在繼續查詢這個 AS-SET 中的其他 AS-SET（這邊的為 AS-STEVEYI-C ）&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-command" data-lang="command">$ steveyiyo@steveyi-MBP ~ % whois -r AS-STEVEYI
as-set: AS-STEVEYI
descr: SteveYi Network Service
members: AS17413
members: AS60614
members: AS141173
members: AS209557
remarks: --- DownStream ---
members: AS-STEVEYI-C
remarks: ----------
tech-c: YT1698-RIPE
admin-c: YT1698-RIPE
mnt-by: STEVEYI-MNT
created: 2020-09-10T18:57:46Z
last-modified: 2021-03-26T15:31:21Z
source: RIPE
&lt;/code>&lt;/pre>&lt;p>接著，我們可以透過 &lt;a href="https://www.radb.net/">RADB&lt;/a> 查詢對應的 Route Object 紀錄&lt;/p>
&lt;p>&lt;img src="https://static-a1.steveyi.net/media/blog/1624742087.png" alt="">&lt;/p>
&lt;p>我們就可以根據這個規則來建立過濾器了！&lt;/p>
&lt;h3 id="建立過濾器" >建立過濾器
&lt;span>
&lt;a href="#%e5%bb%ba%e7%ab%8b%e9%81%8e%e6%bf%be%e5%99%a8">
&lt;svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg">&lt;path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;/svg>
&lt;/a>
&lt;/span>
&lt;/h3>&lt;p>首先，我先推薦一個建立 filter 的工具 - &lt;a href="https://github.com/snar/bgpq3">bgpq3&lt;/a>&lt;br>
他可以針對 ASN 或 AS-SET 產生過濾器，而且支援很多種路由套件或路由系統！&lt;/p>
&lt;pre tabindex="0">&lt;code># 可以直接透過 apt 進行安裝
$ sudo apt install bgpq3
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code># 產生 IPv4 prefix-list
$ bgpq3 -4l AS-STEVEYI_v4 AS-STEVEYI -R 24 -m 24
# 產生 IPv6 prefix-list
$ bgpq3 -6l AS-STEVEYI_v6 AS-STEVEYI -R 48 -m 48
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://static-a1.steveyi.net/media/blog/1624742917.png" alt="">&lt;/p>
&lt;p>接著，我們可以建立一個 &lt;code>route-map&lt;/code> 來針對某個 BGP Peer 過濾&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-conf" data-lang="conf"># vtysh
config
route-map AS-STEVEYI_v4 permit 5
match ip address prefix-list AS-STEVEYI_v4
set community 60614:100
&lt;/code>&lt;/pre>&lt;p>這樣就完成啦！&lt;/p></description></item><item><title>成為 MANRS 參與者！</title><link>https://blog.steveyi.net/posts/join-manrs-as-participants/</link><pubDate>Mon, 25 Jan 2021 00:03:31 +0800</pubDate><guid>https://blog.steveyi.net/posts/join-manrs-as-participants/</guid><description>&lt;p>在去年年底時，我送出了 &lt;a href="https://network.steveyi.net/">SteveYi Network Service&lt;/a> 的 &lt;a href="https://www.manrs.org/">MANRS&lt;/a> 申請&lt;br>
今年年初時，我們通過了審核。正式成為 MANRS 的參與者！&lt;br>
我們的會員介紹在這裏 &lt;a href="https://www.manrs.org/isps/participants/entry/1484/">https://www.manrs.org/isps/participants/entry/1484/&lt;/a>&lt;br>
那麼，我們就順便來說說 我們如何實施 MANRS 政策&lt;/p>
&lt;p>MANRS 主要有四個政策，分別是這些&lt;/p>
&lt;blockquote>
&lt;p>避免廣播錯誤的路由&lt;br>
阻止錯誤偽造的IP流量&lt;br>
促進網絡運營商之間的溝通與協調&lt;br>
促進驗證在網際網路內的路由訊息&lt;/p>
&lt;/blockquote>
&lt;p>那我們是如何做到這些呢？&lt;/p>
&lt;blockquote>
&lt;p>首先，我們在我們的核心路由器上阻斷了 &lt;a href="https://tools.ietf.org/html/rfc1918/">RFC1918&lt;/a> 定義的私網 IP 位置流量，來自這些 &lt;strong>IP位置&lt;/strong> 的流量並不會往公網發送&lt;br>
其次，我們遵守 &lt;a href="https://tools.ietf.org/html/rfc8212/">RFC 8212&lt;/a>，在沒有明確的路由策略下，我們 &lt;strong>不會廣播沒有使用的網段&lt;/strong>。&lt;br>
並且，我們會從我們的 &lt;a href="https://www.radb.net/query?keywords=AS-STEVEYI">AS-STEVEYI&lt;/a> 中產生對應的 IRR 紀錄，並過濾掉 &lt;strong>不屬於我們的路由&lt;/strong>&lt;/p>
&lt;/blockquote>
&lt;p>&lt;img src="https://i.imgur.com/3YMIHgZ.png" alt="">&lt;/p>
&lt;p>我們也會過濾與我們建立私人對等的對等方路由，我們會將所有對等方的 AS-SET 或 ASN 加進我們的 &lt;a href="https://www.radb.net/query?keywords=AS-STEVEYI-A">AS-STEVEYI-A&lt;/a> 中，並自動產生對應的 IRR 紀錄，過濾無效的路由&lt;/p>
&lt;p>我們也歡迎對我們的過濾系統有興趣的網路愛好者/工程師，可以發信至 info_at_steveyi_dot_net 與我們聯繫！&lt;/p></description></item><item><title>透過 BGP 與朋友組成內網</title><link>https://blog.steveyi.net/posts/make-internal-network-by-bgp/</link><pubDate>Sun, 24 Jan 2021 02:00:00 +0000</pubDate><guid>https://blog.steveyi.net/posts/make-internal-network-by-bgp/</guid><description>&lt;p>嗨！好久不見！&lt;/p>
&lt;p>在 2020 初時，我拿到了第一個 ASN號碼 - &lt;a href="https://bgp.he.net/AS209557/">AS209557&lt;/a>&lt;/p>
&lt;p>我也使用了 &lt;a href="https://tools.ietf.org/html/rfc1918">RFC 1918&lt;/a> 所定義的 IP Address ，與我一些朋友透過 BGP 及 Internet 隧道 組成了一個大內網&lt;/p>
&lt;p>那麼，讓我們開始吧！&lt;/p>
&lt;p>首先，我們使用 Ubuntu 20.04 來建立隧道，並與其他人建立 BGP 對等&lt;/p>
&lt;p>那通常，我都是使用 GRE, SIT 或是 WireGuard&lt;/p>
&lt;p>其中，GRE 或 SIT 隧道是屬於非加密隧道，在公網上是可以查看到其封包的。若要加密需要配上 IPsec&lt;/p>
&lt;p>WireGuard 則是在 2019 年 9 月 推出的點對點隧道，在 2020 年 3 月 已列入 Linux 內核&lt;/p>
&lt;p>（其實更早就在 Beta 了，但小易用 WireGuard 時已經是屬於穩定版了）&lt;/p>
&lt;p>那接著，是我與我朋友的對等信息&lt;/p>
&lt;p>PS. 部分 IP Address 被基於安全因素，可能與實際使用的 IP Address 不同&lt;/p>
&lt;p>我的資料&lt;/p>
&lt;pre tabindex="0">&lt;code>公網 IP Address: 59.126.1.1
隧道內 IP Address: 10.0.0.1/30
&lt;/code>&lt;/pre>&lt;p>對方資料&lt;/p>
&lt;pre tabindex="0">&lt;code>公網 IP Address: 140.113.1.1
隧道內 IP Address: 10.0.0.2/30
&lt;/code>&lt;/pre>&lt;p>建立完隧道之後，我們嘗試 ICMP PING 看看&lt;/p>
&lt;pre tabindex="0">&lt;code>root@tw-stuin:~# ping 10.0.0.2
PING 10.0.0.2 (10.0.0.2) 56(84) bytes of data.
64 bytes from 10.0.0.2: icmp_seq=1 ttl=64 time=3.26 ms
64 bytes from 10.0.0.2: icmp_seq=2 ttl=64 time=3.22 ms
64 bytes from 10.0.0.2: icmp_seq=3 ttl=64 time=3.24 ms
--- 10.0.0.2 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2003ms
rtt min/avg/max/mdev = 3.223/3.242/3.259/0.014 ms
&lt;/code>&lt;/pre>&lt;p>好，看起來通了！&lt;/p>
&lt;p>那接著，透過 BGP 協議來組建大內網了！&lt;/p>
&lt;p>首先，我們必須要在 Linux 上安裝一個 BGP Routing Daemon&lt;/p>
&lt;p>在 Linux 系統上，大部分人都使用 &lt;a href="https://bird.network.cz/">BIRD&lt;/a> 或是 &lt;a href="https://frrouting.org/">FRRouting&lt;/a>&lt;/p>
&lt;p>BIRD 比較類似於寫程式的概念(? FRRouting 則是類似於 Cisco 的概念(?&lt;/p>
&lt;p>至少我是這樣認為的，但本篇是使用 FRRouting 來進行操作&lt;/p>
&lt;p>首先，我們可以先參考 &lt;a href="https://blog.steveyi.net/frrouting-install/">這篇文章&lt;/a> 來安裝 FRRouting&lt;/p>
&lt;p>安裝完成之後，我們進入 Cli&lt;/p>
&lt;pre tabindex="0">&lt;code>vtysh
&lt;/code>&lt;/pre>&lt;p>接著，我們輸入以下指令，來開通 BGP 功能 PS. 如果沒有公網 ASN，可以使用 Private ASN 可參考 &lt;a href="https://tools.ietf.org/html/rfc6996">RFC 6996&lt;/a>&lt;/p>
&lt;pre tabindex="0">&lt;code>router bgp 你的ASN
&lt;/code>&lt;/pre>&lt;p>再來，我們輸入對等方資訊&lt;/p>
&lt;pre tabindex="0">&lt;code>neighbor 10.0.0.2 remote-as 對面的ASN
&lt;/code>&lt;/pre>&lt;p>由於是 IPv4 Peer，所以我們需要到 address-family ipv4 來進行設定。以此類推，如果設定 IPv6 的話，則是 address-family ipv6&lt;/p>
&lt;pre tabindex="0">&lt;code>address-family ipv4
&lt;/code>&lt;/pre>&lt;p>接著，我們可以發我們家的內部路由給對面。注意！不要將不屬於自己的路由隨便發給他，否則可能會造成 &lt;a href="https://www.cloudflare.com/en/learning/security/glossary/bgp-hijacking/">BGP hijacking&lt;/a>&lt;/p>
&lt;p>這邊發 10.10.1.0/24 及 192.168.99.0/24 這條路由給對方&lt;/p>
&lt;pre tabindex="0">&lt;code>network 10.10.1.0/24
network 192.168.99.0/24
&lt;/code>&lt;/pre>&lt;p>這邊也建議與對方先溝通好預計會廣播的路由，讓對方可以配好 filter，防止雙方有一方配錯&lt;/p>
&lt;p>後記：&lt;/p>
&lt;p>理論上大概這樣就可以通了！但要特別注意的是，在 ping 對方的時候，記得加上 Source IP Address!! 因為對方可能不會收隧道 IP Address&lt;/p>
&lt;p>但 FRRouting 在 7.5 版時，加入了 &lt;a href="https://tools.ietf.org/html/rfc8212">RFC 8212&lt;/a>&lt;/p>
&lt;p>若沒有明確的路由策略，則不會將路由寫入系統路由表中，也不會發路由給對方&lt;/p></description></item><item><title>從 RIPE 申請屬於自己的 ASN</title><link>https://blog.steveyi.net/posts/get-asn-from-ripe/</link><pubDate>Sat, 21 Nov 2020 08:39:28 +0000</pubDate><guid>https://blog.steveyi.net/posts/get-asn-from-ripe/</guid><description>&lt;p>今天來講一下透過 LIR 在 RIPE 取得自己的 ASN&lt;/p>
&lt;p>首先，可能有些人會很好奇&lt;/p>
&lt;p>&lt;strong>為什麼要選擇 RIPE 呢？選擇 APNIC, ARIN 不好嗎？&lt;/strong>&lt;/p>
&lt;p>筆者有兩個 ASN，分別是 RIPE 及 APNIC 下的&lt;br>
當筆者在改一些 whois 時，RIPE 可以直接進入網頁修改&lt;br>
但 APNIC 則需要發送郵件&amp;hellip;&amp;hellip;比較麻煩(其實好像也差不多)&lt;/p>
&lt;p>不過，APNIC 與 RIPE 兩個管理機構也是有差別的&lt;br>
RIPE 需要驗證真實身份(個人申請需要發送護照或其他證明文件)&lt;br>
APNIC 則不需要任何證明文件&lt;/p>
&lt;p>那麼，我們就開始申請吧&lt;/p>
&lt;h1 id="尋找-lir贊助者" >&lt;strong>尋找 LIR（贊助者）&lt;/strong>
&lt;span>
&lt;a href="#%e5%b0%8b%e6%89%be-lir%e8%b4%8a%e5%8a%a9%e8%80%85">
&lt;svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg">&lt;path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;/svg>
&lt;/a>
&lt;/span>
&lt;/h1>&lt;p>首先，我們需要找到一位 RIPE 會員 (LIR) 做自己的 Sponsor&lt;br>
我們只要在 Google 上搜尋「Lir Service」就會看到非常多的相關服務&lt;/p>
&lt;p>&lt;img src="https://static-a1.steveyi.net/media/blog/2020111814292492.png" alt="">&lt;/p>
&lt;p>那小易嘗試過 &lt;a href="https://freetransit.ch/">Openfactory&lt;/a> 的服務，非常推薦其服務！（雖然比較慢）&lt;/p>
&lt;h1 id="準備申請資料" >&lt;strong>準備申請資料&lt;/strong>
&lt;span>
&lt;a href="#%e6%ba%96%e5%82%99%e7%94%b3%e8%ab%8b%e8%b3%87%e6%96%99">
&lt;svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg">&lt;path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;/svg>
&lt;/a>
&lt;/span>
&lt;/h1>&lt;p>我們找到 LIR 之後，透過 Email 或其他管道聯繫後，我們就可以來準備一下申請資料了&lt;br>
根據小易的經驗，大部分 LIR 都需要這些東西（因為他們需要提交給 RIPE ）&lt;/p>
&lt;p>真實英文姓名 (First + Last name)，也就是護照上的名稱&lt;br>
Postal address（真實地址）&lt;br>
護照的複印/掃描圖片（有時候可能需要身份證照片）&lt;/p>
&lt;p>接著還需要兩個對等方，也就是我們常說的 &amp;ldquo;Peer Partner&amp;rdquo;&lt;br>
如果各位不介意的話，可以直接填寫我的資訊&lt;/p>
&lt;p>AS60614(TSUNGYI YU)
peering_at_steveyi.net&lt;/p>
&lt;p>AS209557(TSUNGYI YU)
peering_at_steveyi.net&lt;/p>
&lt;p>然後由於我們是在 RIPE 申請的，所以我們還需要準備一些對象紀錄&lt;br>
MAINTAINER, PERSON / ROLE, and ORGANIZATION object&lt;br>
然後O RG object 中的 &amp;ldquo;org-name&amp;rdquo; 必須要是真實姓名（護照名稱）&lt;br>
關於申請的過程及方式，可以參考一下 &lt;a href="https://blog.steveyi.net/create-object-in-ripe-database/">這篇文章&lt;/a>&lt;/p>
&lt;p>那一切都準備好後，LIR 會準備一分用戶協議，簽名完，LIR 就會把你的請求轉交給 RIPE 啦！&lt;br>
當提交請求給 RIPE 時，大約 1-3 天就會發放 ASN 了&lt;/p>
&lt;p>當拿到 ASN 之後，我們就可以來廣播自己的網路啦！&lt;br>
那我們下一篇會再詳細地與大家分享廣播網路的細節&lt;/p></description></item><item><title>在 RIPE DataBase 建立 Object</title><link>https://blog.steveyi.net/posts/create-object-in-ripe-database/</link><pubDate>Sat, 21 Nov 2020 08:37:20 +0000</pubDate><guid>https://blog.steveyi.net/posts/create-object-in-ripe-database/</guid><description>&lt;p>在本篇文章中，將與大家分享如何在 RIPE DataBase 註冊 MAINTAINER, PERSON / ROLE, and ORGANIZATION object&lt;/p>
&lt;p>這些對象也是註冊 ASN 必要的，如果要申請 ASN，可以參考 &lt;a href="https://blog.steveyi.net/get-asn-from-ripe/">這篇教學&lt;/a>&lt;/p>
&lt;p>那首先，我們要先註冊 RIPE 的帳號 &lt;a href="https://access.ripe.net/registration">註冊網站在這&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://static-a1.steveyi.net/media/blog/2020112108155764.png" alt="">&lt;/p>
&lt;p>註冊完成之後，我們進入 RIPE Datebase，然後點擊 &amp;ldquo;Create an Object&amp;rdquo;（建立一個物件Object）&lt;/p>
&lt;p>&lt;img src="https://static-a1.steveyi.net/media/blog/2020112108175021.png" alt="">&lt;/p>
&lt;p>然後我們選擇第一個 &amp;ldquo;role and maintainer pair&amp;rdquo;&lt;/p>
&lt;p>&lt;img src="https://static-a1.steveyi.net/media/blog/2020112108190258.png" alt="">&lt;/p>
&lt;p>第一個填寫 mnter，他將會是 &amp;ldquo;mnt-by&amp;rdquo;&lt;br>
role 隨意輸入&lt;br>
address 寫自己家裡地址&lt;br>
email 寫自己的電子郵箱地址&lt;/p>
&lt;p>&lt;img src="https://static-a1.steveyi.net/media/blog/2020112108210139.png" alt="">&lt;/p>
&lt;p>註冊完成後，你會拿到一個 role 與 mnter，這邊要記住 primary key&lt;br>
我們等等會用到&lt;/p>
&lt;p>&lt;img src="https://static-a1.steveyi.net/media/blog/2020112108240373.png" alt="">&lt;/p>
&lt;p>建立好後，我們需要在回去 role，新增一個 &amp;ldquo;abuse-mailbox&amp;rdquo; 濫用投訴信箱，等等ORG object需要使用&lt;/p>
&lt;p>&lt;img src="https://static-a1.steveyi.net/media/blog/2020112108270350.png" alt="">&lt;/p>
&lt;p>完成後，我們回到 &amp;ldquo;Create an Object&amp;rdquo;（建立一個物件Object）的步驟&lt;br>
這次選擇建立 Organisation&lt;/p>
&lt;p>&lt;img src="https://static-a1.steveyi.net/media/blog/2020112108273384.png" alt="">&lt;/p>
&lt;p>完成後，我們點擊Submit&lt;br>
我們需要更改的內容有&lt;br>
&amp;ldquo;org-name&amp;rdquo;: 填寫自己的真實英文姓名(護照上的)&lt;br>
&amp;ldquo;address&amp;rdquo;: 地址&lt;br>
&amp;ldquo;e-mail&amp;rdquo;: 電子郵件地址&lt;br>
&amp;ldquo;abuse-c&amp;rdquo;: 剛剛我們建立的role&lt;br>
&amp;ldquo;mnt-ref&amp;rdquo;: 剛剛我們建立的mnter&lt;/p>
&lt;p>&lt;img src="https://static-a1.steveyi.net/media/blog/2020112108330053.png" alt="">&lt;/p>
&lt;p>完成後，我們點擊 Submit&lt;br>
就完成啦&lt;/p>
&lt;p>&lt;img src="https://static-a1.steveyi.net/media/blog/2020112108331094.png" alt="">&lt;/p>
&lt;p>最後，我們只需要將 ORG 的編號給 LIR，就可以啦！&lt;/p>
&lt;p>如果還是不懂的話，可以參考RIPE的影片！https://www.ripe.net/support/training/videos/ripe-database&lt;/p></description></item><item><title>FRRouting 安裝教學</title><link>https://blog.steveyi.net/posts/frrouting-install/</link><pubDate>Sun, 12 Jul 2020 13:07:14 +0000</pubDate><guid>https://blog.steveyi.net/posts/frrouting-install/</guid><description>&lt;p>很久沒有來分享了！最近仍然在學習 BGP 知識及測試之前一直使用 Bird1 來廣播 BGP，後來在跟朋友 Peer 時，一直無法建立對等（很玄，但卻可以跟 IX 建立）&lt;/p>
&lt;p>於是我將 Bird1 解除安裝了，改安裝 &lt;a href="https://frrouting.org/">FRRouting&lt;/a>。&lt;/p>
&lt;p>&lt;a href="https://frrouting.org/">FRRouting&lt;/a> 是從 Quagga Fork 來的路由套件，功能也十分強大（ 其指令類似於 Cisco 或 Quagga ）&lt;/p>
&lt;p>使用者指南（英文）：&lt;a href="https://docs.frrouting.org/en/latest/">https://docs.frrouting.org/en/latest/&lt;/a>&lt;br>
GitHub 專案：&lt;a href="https://github.com/FRRouting/frr/releases">https://github.com/FRRouting/frr/releases&lt;/a>&lt;/p>
&lt;p>首先，我們要先來安裝 &lt;a href="https://frrouting.org/">FRRouting&lt;/a>&lt;/p>
&lt;h3 id="更新套件" >更新套件
&lt;span>
&lt;a href="#%e6%9b%b4%e6%96%b0%e5%a5%97%e4%bb%b6">
&lt;svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg">&lt;path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;/svg>
&lt;/a>
&lt;/span>
&lt;/h3>&lt;pre tabindex="0">&lt;code>sudo apt update -y
sudo apt upgrade -y
# 安裝網路套件及 GPG 套件
sudo apt install -y curl gnupg2 traceroute
&lt;/code>&lt;/pre>&lt;h3 id="安裝-frrouting" >安裝 FRRouting
&lt;span>
&lt;a href="#%e5%ae%89%e8%a3%9d-frrouting">
&lt;svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg">&lt;path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;/svg>
&lt;/a>
&lt;/span>
&lt;/h3>&lt;pre tabindex="0">&lt;code># 導入 GPG
curl -s https://deb.frrouting.org/frr/keys.asc | sudo apt-key add -
FRRVER=&amp;quot;frr-stable&amp;quot;
# 寫入軟體源
echo deb https://deb.frrouting.org/frr $(lsb_release -s -c) $FRRVER | sudo tee -a /etc/apt/sources.list.d/frr.list
# 安裝 FRRouting
sudo apt update -y &amp;amp;&amp;amp; sudo apt install -y frr frr-pythontools
&lt;/code>&lt;/pre>&lt;h3 id="開啟-ip-forwarding" >開啟 IP forwarding
&lt;span>
&lt;a href="#%e9%96%8b%e5%95%9f-ip-forwarding">
&lt;svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg">&lt;path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;/svg>
&lt;/a>
&lt;/span>
&lt;/h3>&lt;pre tabindex="0">&lt;code>echo &amp;quot;
net.ipv4.conf.all.forwarding = 1
net.ipv6.conf.all.disable_ipv6 = 0
net.ipv6.conf.default.disable_ipv6 = 0
net.ipv6.conf.lo.disable_ipv6 = 0
net.ipv6.conf.default.forwarding = 1
net.ipv6.conf.all.forwarding = 1
net.ipv6.conf.all.proxy_ndp = 1
net.ipv6.conf.all.accept_ra = 2
&amp;quot; | sudo tee -a /etc/sysctl.conf
sudo sysctl -p
&lt;/code>&lt;/pre>&lt;h3 id="啟動-frrouting-所有功能" >啟動 FRRouting 所有功能
&lt;span>
&lt;a href="#%e5%95%9f%e5%8b%95-frrouting-%e6%89%80%e6%9c%89%e5%8a%9f%e8%83%bd">
&lt;svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg">&lt;path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;/svg>
&lt;/a>
&lt;/span>
&lt;/h3>&lt;pre tabindex="0">&lt;code>sudo sed -i &amp;quot;s/=no/=yes/g&amp;quot; /etc/frr/daemons
service frr restart
&lt;/code>&lt;/pre>&lt;h3 id="進入-frrouting-互動-cli" >進入 FRRouting 互動 Cli
&lt;span>
&lt;a href="#%e9%80%b2%e5%85%a5-frrouting-%e4%ba%92%e5%8b%95-cli">
&lt;svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg">&lt;path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;/svg>
&lt;/a>
&lt;/span>
&lt;/h3>&lt;pre tabindex="0">&lt;code>sudo vtysh
&lt;/code>&lt;/pre>&lt;p>進入互動式 Cli，不出意外的話&lt;br>
應該會看到下面這樣&lt;/p>
&lt;p>接著就可以進行配置了&lt;br>
鍵入 config 就可以進入設定界面囉！&lt;/p></description></item><item><title>在 Linux 系統上安裝 Wireguard</title><link>https://blog.steveyi.net/posts/how-to-install-wireguard/</link><pubDate>Sat, 16 May 2020 11:51:52 +0000</pubDate><guid>https://blog.steveyi.net/posts/how-to-install-wireguard/</guid><description>&lt;p>&lt;a href="https://wireguard.com">Wireguard&lt;/a>是一個點對點加密網路&lt;/p>
&lt;p>一直以來，我都使用它來管理我所有的雲端主機&lt;/p>
&lt;p>今天就來分享一下安裝方法吧！&lt;/p>
&lt;p>安裝指令請參考 &lt;a href="https://www.wireguard.com/install/">https://www.wireguard.com/install/&lt;/a>&lt;/p>
&lt;p>首先，進入Wireguard安裝資料夾&lt;br>
如果找不到的話，請建立一下&lt;/p>
&lt;pre tabindex="0">&lt;code>cd /etc/wireguard
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://static-a1.steveyi.net/media/blog/2020051611394599.png" alt="">&lt;/p>
&lt;p>接著，我們使用指令來產生公私鑰，並使用cat查看公私鑰內容&lt;/p>
&lt;pre tabindex="0">&lt;code>wg genkey | tee privatekey | wg pubkey &amp;gt; publickey
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://static-a1.steveyi.net/media/blog/2020051611445527.png" alt="">&lt;/p>
&lt;p>接著我們將公私鑰記下來，我們建立一個配置文件&lt;/p>
&lt;pre tabindex="0">&lt;code>nano wg0.conf
&lt;/code>&lt;/pre>&lt;p>進入nano 編輯器後，我們將下方代碼貼上，並修改公私鑰&lt;/p>
&lt;pre tabindex="0">&lt;code>[Interface]
Address = 192.168.200.1/24 //這邊可以自定網段
SaveConfig = true
ListenPort = 51820
PrivateKey = 修改為私鑰
[Peer]
PublicKey = 對方的公鑰
AllowedIPs = 192.168.200.2/24 //對方的網段
&lt;/code>&lt;/pre>&lt;p>接著輸入 Crtl + X 在輸入y 退出編輯器&lt;/p>
&lt;p>接著使用指令，來存檔並啟用wireguard&lt;/p>
&lt;pre tabindex="0">&lt;code>wg-quick save wg0
wg-quick down wg0
wg-quick up wg0
&lt;/code>&lt;/pre>&lt;p>PS.開機自動啟動指令&lt;/p>
&lt;pre tabindex="0">&lt;code>systemctl enable wg-quick@wg0
&lt;/code>&lt;/pre>&lt;p>接著可以嘗試ping看看，如果有響應的話&lt;/p>
&lt;p>代表成功了！&lt;/p>
&lt;p>&lt;img src="https://static-a1.steveyi.net/media/blog/2020051612102187.png" alt="">&lt;/p></description></item><item><title>在 Vultr 使用 Bird6 廣播 IPv6</title><link>https://blog.steveyi.net/posts/use-bird6-broadcast-ipv6-vultr/</link><pubDate>Fri, 10 Apr 2020 02:21:55 +0000</pubDate><guid>https://blog.steveyi.net/posts/use-bird6-broadcast-ipv6-vultr/</guid><description>&lt;p>&lt;img src="https://static-a1.steveyi.net/media/blog/2020/04/vu-00.png" alt="">&lt;/p>
&lt;p>&lt;strong>建議可以參考於 2021 年 01 月 24 日 的 &lt;a href="https://blog.steveyi.net/posts/make-internal-network-by-bgp/">透過 BGP 與朋友組成內網&lt;/a> 文章&lt;/strong>&lt;/p>
&lt;p>這次就來分享一下在 &lt;a href="https://vultr.com">Vultr&lt;/a> 廣播IP吧！&lt;/p>
&lt;h1 id="設置-as-號碼及-ip-前綴" >&lt;strong>設置 AS 號碼及 IP 前綴&lt;/strong>
&lt;span>
&lt;a href="#%e8%a8%ad%e7%bd%ae-as-%e8%99%9f%e7%a2%bc%e5%8f%8a-ip-%e5%89%8d%e7%b6%b4">
&lt;svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg">&lt;path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;/svg>
&lt;/a>
&lt;/span>
&lt;/h1>&lt;p>首先，我們要先開通 BGP 的功能！
&lt;a href="https://my.vultr.com/network/#network-bgp">點擊這裡前往 Vultr BGP 頁面&lt;/a>
進入此頁面後，我們點擊 Get Started&lt;/p>
&lt;p>&lt;img src="https://static-a1.steveyi.net/media/blog/2020/04/vu-01-1920x961.png" alt="">&lt;/p>
&lt;p>選擇 I have my own IP space 及 I have own my ASN (如果沒有 ASN 不用選擇)&lt;/p>
&lt;p>而關於 LOA 的部分，可以參考 &lt;a href="https://www.vultr.com/docs/example-letter-of-authorization-for-bgp-announcements/">這份&lt;/a> 範例文件&lt;/p>
&lt;p>接著其他保持預設就好&lt;/p>
&lt;p>&lt;img src="https://static-a1.steveyi.net/media/blog/2020/04/vu-02.png" alt="">&lt;/p>
&lt;p>接著點 Start，來驗證 IP 擁有權 或 ASN&lt;/p>
&lt;p>&lt;img src="https://static-a1.steveyi.net/media/blog/2020/04/vu-03-1920x362.png" alt="">&lt;/p>
&lt;p>系統會寄一封電子郵件到 Whois 的 Email，進行驗證！&lt;/p>
&lt;p>&lt;img src="https://static-a1.steveyi.net/media/blog/2020/04/vu-04.png" alt="">&lt;/p>
&lt;p>驗證完後呢，我們就等待工作人員設置&lt;/p>
&lt;h1 id="廣播" >&lt;strong>廣播&lt;/strong>
&lt;span>
&lt;a href="#%e5%bb%a3%e6%92%ad">
&lt;svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg">&lt;path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/>&lt;/svg>
&lt;/a>
&lt;/span>
&lt;/h1>&lt;p>這次是使用 Ubuntu 18.04 來進行宣告的，CentOS 及 Debian 應該大同小異&lt;/p>
&lt;p>首先我們先安裝幾個套件&lt;/p>
&lt;pre tabindex="0">&lt;code>apt-get update -y
apt-get install bird6 -y
&lt;/code>&lt;/pre>&lt;p>安裝完成後，我們進入 /etc/bird 資料夾&lt;/p>
&lt;pre tabindex="0">&lt;code>cd /etc/bird
&lt;/code>&lt;/pre>&lt;p>刪除 bird6.conf&lt;/p>
&lt;pre tabindex="0">&lt;code>sudo rm -rf bird6.conf
&lt;/code>&lt;/pre>&lt;p>接著我們新增一個新的設定檔&lt;/p>
&lt;pre tabindex="0">&lt;code>router id 0.0.0.0; # 將0.0.0.0改成你的主機IPv4
protocol bgp vultr
{
   local as 209557;
   source address 改成主機IPv6;
   import none;
   export all;
   graceful restart on;
   multihop 2;
   neighbor 2001:19f0:ffff::1 as 64515; # Vultr的IP及私有AS號
   password &amp;quot;123456789&amp;quot;; # 之前設定的BGP密碼
}
protocol static
{
    route 要宣告的 prefix via 閘道 IP;
}
protocol device 
{
    scan time 5;
}
&lt;/code>&lt;/pre>&lt;p>設置好後，我們重啟bird6&lt;/p>
&lt;pre tabindex="0">&lt;code>service bird6 restart
&lt;/code>&lt;/pre>&lt;p>接著我們就可以嘗試追蹤路由看看囉！&lt;/p></description></item></channel></rss>