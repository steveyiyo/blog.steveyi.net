<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Building an Internal Network with Friends using BGP | SteveYi's Blog</title><meta name=keywords content="BGP,Network"><meta name=description content="Hi! Long time no see!
In early 2020, I obtained my first ASN number - AS209557
I also used IP Addresses defined by RFC 1918, and with some friends, I built a large internal network using BGP and Internet tunnels.
So let&rsquo;s get started!
First, we use Ubuntu 20.04 to establish a tunnel and establish BGP peerings with others.
Usually, I use GRE, SIT, or WireGuard.
Among them, GRE or SIT tunnels are non-encrypted tunnels that can be viewed on the public network."><meta name=author content="SteveYi"><link rel=canonical href=https://blog.steveyi.net/en/posts/make-internal-network-by-bgp/><link crossorigin=anonymous href=/assets/css/stylesheet.bccfefac377bc340f06c260aed1bddf49a4354816d7c570d6aac75a997986c95.css integrity="sha256-vM/vrDd7w0DwbCYK7Rvd9JpDVIFtfFcNaqx1qZeYbJU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.steveyi.net/images/me.png><link rel=icon type=image/png sizes=16x16 href=https://blog.steveyi.net/images/me.png><link rel=icon type=image/png sizes=32x32 href=https://blog.steveyi.net/images/me.png><link rel=apple-touch-icon href=https://blog.steveyi.net/images/me.png><link rel=mask-icon href=https://blog.steveyi.net/images/me.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.steveyi.net/en/posts/make-internal-network-by-bgp/><link rel=alternate hreflang=tw href=https://blog.steveyi.net/posts/make-internal-network-by-bgp/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-CPGWT2M3VT"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-CPGWT2M3VT",{anonymize_ip:!1})}</script><meta property="og:title" content="Building an Internal Network with Friends using BGP"><meta property="og:description" content="Hi! Long time no see!
In early 2020, I obtained my first ASN number - AS209557
I also used IP Addresses defined by RFC 1918, and with some friends, I built a large internal network using BGP and Internet tunnels.
So let&rsquo;s get started!
First, we use Ubuntu 20.04 to establish a tunnel and establish BGP peerings with others.
Usually, I use GRE, SIT, or WireGuard.
Among them, GRE or SIT tunnels are non-encrypted tunnels that can be viewed on the public network."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.steveyi.net/en/posts/make-internal-network-by-bgp/"><meta property="og:image" content="https://blog.steveyi.net/images/banner.webp"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-01-24T02:00:00+00:00"><meta property="article:modified_time" content="2021-01-24T02:00:00+00:00"><meta property="og:site_name" content="SteveYi's Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.steveyi.net/images/banner.webp"><meta name=twitter:title content="Building an Internal Network with Friends using BGP"><meta name=twitter:description content="Hi! Long time no see!
In early 2020, I obtained my first ASN number - AS209557
I also used IP Addresses defined by RFC 1918, and with some friends, I built a large internal network using BGP and Internet tunnels.
So let&rsquo;s get started!
First, we use Ubuntu 20.04 to establish a tunnel and establish BGP peerings with others.
Usually, I use GRE, SIT, or WireGuard.
Among them, GRE or SIT tunnels are non-encrypted tunnels that can be viewed on the public network."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.steveyi.net/en/posts/"},{"@type":"ListItem","position":2,"name":"Building an Internal Network with Friends using BGP","item":"https://blog.steveyi.net/en/posts/make-internal-network-by-bgp/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Building an Internal Network with Friends using BGP","name":"Building an Internal Network with Friends using BGP","description":"Hi! Long time no see!\nIn early 2020, I obtained my first ASN number - AS209557\nI also used IP Addresses defined by RFC 1918, and with some friends, I built a large internal network using BGP and Internet tunnels.\nSo let\u0026rsquo;s get started!\nFirst, we use Ubuntu 20.04 to establish a tunnel and establish BGP peerings with others.\nUsually, I use GRE, SIT, or WireGuard.\nAmong them, GRE or SIT tunnels are non-encrypted tunnels that can be viewed on the public network.","keywords":["BGP","Network"],"articleBody":"Hi! Long time no see!\nIn early 2020, I obtained my first ASN number - AS209557\nI also used IP Addresses defined by RFC 1918, and with some friends, I built a large internal network using BGP and Internet tunnels.\nSo let’s get started!\nFirst, we use Ubuntu 20.04 to establish a tunnel and establish BGP peerings with others.\nUsually, I use GRE, SIT, or WireGuard.\nAmong them, GRE or SIT tunnels are non-encrypted tunnels that can be viewed on the public network. To encrypt, IPsec needs to be configured.\nWireGuard is a point-to-point tunnel launched in September 2019 and was included in the Linux kernel in March 2020.\n(Actually, it was in Beta earlier, but when Xiaoyi used WireGuard, it was already a stable version.)\nNext, here are my peer information and my friends’ peer information.\nPS. Some IP Addresses may differ from the actual IP Addresses used for security reasons.\nMy information\nPublic IP Address: 59.126.1.1 Tunnel IP Address: 10.0.0.1/30 Friend’s information\nPublic IP Address: 140.113.1.1 Tunnel IP Address: 10.0.0.2/30 After the tunnel is established, let’s try ICMP PING.\nroot@tw-stuin:~# ping 10.0.0.2 PING 10.0.0.2 (10.0.0.2) 56(84) bytes of data. 64 bytes from 10.0.0.2: icmp_seq=1 ttl=64 time=3.26 ms 64 bytes from 10.0.0.2: icmp_seq=2 ttl=64 time=3.22 ms 64 bytes from 10.0.0.2: icmp_seq=3 ttl=64 time=3.24 ms --- 10.0.0.2 ping statistics --- 3 packets transmitted, 3 received, 0% packet loss, time 2003ms rtt min/avg/max/mdev = 3.223/3.242/3.259/0.014 ms Okay, it seems to be working!\nNext, let’s build a large internal network using the BGP protocol!\nFirst, we need to install a BGP Routing Daemon on Linux.\nMost people use BIRD or FRRouting on Linux systems.\nBIRD is more similar to the concept of programming(? FRRouting is similar to the concept of Cisco(?\nAt least that’s how I think, but this article uses FRRouting for operation.\nFirst, we can refer to this article to install FRRouting.\nAfter installation, we enter Cli.\nvtysh Next, we enter the following command to enable BGP function. PS. If there is no public ASN, you can use Private ASN, which can refer to RFC 6996.\nrouter bgp yourASN Then, we enter the peer information.\nneighbor 10.0.0.2 remote-as theASNoftheotherparty Since it is an IPv4 Peer, we need to go to address-family ipv4 to do the settings. Similarly, if setting up IPv6, it is address-family ipv6.\naddress-family ipv4 Then, we can send our internal route to the peer. Note! Do not send routes that do not belong to yourself to others, otherwise it may cause BGP hijacking.\nHere we send the 10.10.1.0/24 and 192.168.99.0/24 routes to the other party.\nnetwork 10.10.1.0/24 network 192.168.99.0/24 Here, it is also recommended to communicate with the other party in advance about the expected broadcast routes, so that the other party can set up filters to prevent one party from setting up incorrectly.\nPostscript:\nIn theory, that’s about it! But be sure to note that when pinging the other party, be sure to add the Source IP Address!! Because the other party may not receive the tunnel IP Address.\nHowever, FRRouting added RFC 8212 in version 7.5.\nIf there is no clear routing policy, the route will not be written to the system routing table, nor will it send routes to the other party.\n","wordCount":"538","inLanguage":"en","datePublished":"2021-01-24T02:00:00Z","dateModified":"2021-01-24T02:00:00Z","author":{"@type":"Person","name":"SteveYi"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.steveyi.net/en/posts/make-internal-network-by-bgp/"},"publisher":{"@type":"Organization","name":"SteveYi's Blog","logo":{"@type":"ImageObject","url":"https://blog.steveyi.net/images/me.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.steveyi.net/en/ accesskey=h title="SteveYi's Blog (Alt + H)">SteveYi's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://blog.steveyi.net/ title=正體中文 aria-label=正體中文>Tw</a></li></ul></div></div><ul id=menu><li><a href=https://blog.steveyi.net/en/ title=首頁><span>首頁</span></a></li><li><a href=https://blog.steveyi.net/en/posts/ title=文章列表><span>文章列表</span></a></li><li><a href=https://blog.steveyi.net/en/about/ title=關於小易><span>關於小易</span></a></li><li><a href=https://twitter.com/steveyiyo title=Twitter><span>Twitter</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Building an Internal Network with Friends using BGP</h1><div class=post-meta><span title='2021-01-24 02:00:00 +0000 UTC'>January 24, 2021</span>&nbsp;·&nbsp;SteveYi&nbsp;|&nbsp;Translations:<ul class=i18n_list><li><a href=https://blog.steveyi.net/posts/make-internal-network-by-bgp/>Tw</a></li></ul></div></header><div class=post-content><p>Hi! Long time no see!</p><p>In early 2020, I obtained my first ASN number - <a href=https://bgp.he.net/AS209557/>AS209557</a></p><p>I also used IP Addresses defined by <a href=https://tools.ietf.org/html/rfc1918>RFC 1918</a>, and with some friends, I built a large internal network using BGP and Internet tunnels.</p><p>So let&rsquo;s get started!</p><p>First, we use Ubuntu 20.04 to establish a tunnel and establish BGP peerings with others.</p><p>Usually, I use GRE, SIT, or WireGuard.</p><p>Among them, GRE or SIT tunnels are non-encrypted tunnels that can be viewed on the public network. To encrypt, IPsec needs to be configured.</p><p>WireGuard is a point-to-point tunnel launched in September 2019 and was included in the Linux kernel in March 2020.</p><p>(Actually, it was in Beta earlier, but when Xiaoyi used WireGuard, it was already a stable version.)</p><p>Next, here are my peer information and my friends&rsquo; peer information.</p><p>PS. Some IP Addresses may differ from the actual IP Addresses used for security reasons.</p><p>My information</p><pre tabindex=0><code>Public IP Address: 59.126.1.1
Tunnel IP Address: 10.0.0.1/30
</code></pre><p>Friend&rsquo;s information</p><pre tabindex=0><code>Public IP Address: 140.113.1.1
Tunnel IP Address: 10.0.0.2/30
</code></pre><p>After the tunnel is established, let&rsquo;s try ICMP PING.</p><pre tabindex=0><code>root@tw-stuin:~# ping 10.0.0.2
PING 10.0.0.2 (10.0.0.2) 56(84) bytes of data.
64 bytes from 10.0.0.2: icmp_seq=1 ttl=64 time=3.26 ms
64 bytes from 10.0.0.2: icmp_seq=2 ttl=64 time=3.22 ms
64 bytes from 10.0.0.2: icmp_seq=3 ttl=64 time=3.24 ms
--- 10.0.0.2 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2003ms
rtt min/avg/max/mdev = 3.223/3.242/3.259/0.014 ms
</code></pre><p>Okay, it seems to be working!</p><p>Next, let&rsquo;s build a large internal network using the BGP protocol!</p><p>First, we need to install a BGP Routing Daemon on Linux.</p><p>Most people use <a href=https://bird.network.cz/>BIRD</a> or <a href=https://frrouting.org/>FRRouting</a> on Linux systems.</p><p>BIRD is more similar to the concept of programming(? FRRouting is similar to the concept of Cisco(?</p><p>At least that&rsquo;s how I think, but this article uses FRRouting for operation.</p><p>First, we can refer to <a href=https://blog.steveyi.net/frrouting-install/>this article</a> to install FRRouting.</p><p>After installation, we enter Cli.</p><pre tabindex=0><code>vtysh
</code></pre><p>Next, we enter the following command to enable BGP function. PS. If there is no public ASN, you can use Private ASN, which can refer to <a href=https://tools.ietf.org/html/rfc6996>RFC 6996</a>.</p><pre tabindex=0><code>router bgp yourASN
</code></pre><p>Then, we enter the peer information.</p><pre tabindex=0><code>neighbor 10.0.0.2 remote-as theASNoftheotherparty
</code></pre><p>Since it is an IPv4 Peer, we need to go to address-family ipv4 to do the settings. Similarly, if setting up IPv6, it is address-family ipv6.</p><pre tabindex=0><code>address-family ipv4
</code></pre><p>Then, we can send our internal route to the peer. Note! Do not send routes that do not belong to yourself to others, otherwise it may cause <a href=https://www.cloudflare.com/en/learning/security/glossary/bgp-hijacking/>BGP hijacking</a>.</p><p>Here we send the 10.10.1.0/24 and 192.168.99.0/24 routes to the other party.</p><pre tabindex=0><code>network 10.10.1.0/24
network 192.168.99.0/24
</code></pre><p>Here, it is also recommended to communicate with the other party in advance about the expected broadcast routes, so that the other party can set up filters to prevent one party from setting up incorrectly.</p><p>Postscript:</p><p>In theory, that&rsquo;s about it! But be sure to note that when pinging the other party, be sure to add the Source IP Address!! Because the other party may not receive the tunnel IP Address.</p><p>However, FRRouting added <a href=https://tools.ietf.org/html/rfc8212>RFC 8212</a> in version 7.5.</p><p>If there is no clear routing policy, the route will not be written to the system routing table, nor will it send routes to the other party.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.steveyi.net/en/tags/bgp/>BGP</a></li><li><a href=https://blog.steveyi.net/en/tags/network/>Network</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://blog.steveyi.net/en/>SteveYi's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>