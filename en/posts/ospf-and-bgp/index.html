<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Optimizing Intranet with OSPF and BGP | SteveYi's Blog</title><meta name=keywords content><meta name=description content="For a long time, my friends and I have had an intranet similar to DN42. We use VPN to establish BGP connections and deploy this intranet using various devices in different areas.
P.S. Currently, there are about 46 routes.
Currently, I am building a BGP peer with other people from one point and using static routes to handle internal routing.
For example, if the device 10.121.23.242 wants to reach a device 10."><meta name=author content="SteveYi"><link rel=canonical href=https://blog.steveyi.net/en/posts/ospf-and-bgp/><link crossorigin=anonymous href=/assets/css/stylesheet.bccfefac377bc340f06c260aed1bddf49a4354816d7c570d6aac75a997986c95.css integrity="sha256-vM/vrDd7w0DwbCYK7Rvd9JpDVIFtfFcNaqx1qZeYbJU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.steveyi.net/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.steveyi.net/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.steveyi.net/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.steveyi.net/apple-touch-icon.png><link rel=mask-icon href=https://blog.steveyi.net/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.steveyi.net/en/posts/ospf-and-bgp/><link rel=alternate hreflang=tw href=https://blog.steveyi.net/posts/ospf-and-bgp/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-CPGWT2M3VT"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-CPGWT2M3VT",{anonymize_ip:!1})}</script><meta property="og:title" content="Optimizing Intranet with OSPF and BGP"><meta property="og:description" content="For a long time, my friends and I have had an intranet similar to DN42. We use VPN to establish BGP connections and deploy this intranet using various devices in different areas.
P.S. Currently, there are about 46 routes.
Currently, I am building a BGP peer with other people from one point and using static routes to handle internal routing.
For example, if the device 10.121.23.242 wants to reach a device 10."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.steveyi.net/en/posts/ospf-and-bgp/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-05-16T22:17:25+08:00"><meta property="article:modified_time" content="2021-05-16T22:17:25+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Optimizing Intranet with OSPF and BGP"><meta name=twitter:description content="For a long time, my friends and I have had an intranet similar to DN42. We use VPN to establish BGP connections and deploy this intranet using various devices in different areas.
P.S. Currently, there are about 46 routes.
Currently, I am building a BGP peer with other people from one point and using static routes to handle internal routing.
For example, if the device 10.121.23.242 wants to reach a device 10."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.steveyi.net/en/posts/"},{"@type":"ListItem","position":2,"name":"Optimizing Intranet with OSPF and BGP","item":"https://blog.steveyi.net/en/posts/ospf-and-bgp/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Optimizing Intranet with OSPF and BGP","name":"Optimizing Intranet with OSPF and BGP","description":"For a long time, my friends and I have had an intranet similar to DN42. We use VPN to establish BGP connections and deploy this intranet using various devices in different areas.\nP.S. Currently, there are about 46 routes.\nCurrently, I am building a BGP peer with other people from one point and using static routes to handle internal routing.\nFor example, if the device 10.121.23.242 wants to reach a device 10.","keywords":[],"articleBody":"For a long time, my friends and I have had an intranet similar to DN42. We use VPN to establish BGP connections and deploy this intranet using various devices in different areas.\nP.S. Currently, there are about 46 routes.\nCurrently, I am building a BGP peer with other people from one point and using static routes to handle internal routing.\nFor example, if the device 10.121.23.242 wants to reach a device 10.121.210.3 on my intranet:\nFor example, I set up a route 10.121.210.0/24 on the core router to the router placed in the school. On the school router, I established a BGP peer with the core router to receive the full table of our intranet.\nThis can make our network work, but when the core router fails, others cannot enter my intranet.\nSo I thought of using OSPF and iBGP to solve the problem of a single core router failure.\nWhat is OSPF? OSPF, short for Open Shortest Path First, is an IGP protocol that uses Link State Routing algorithm.\nThe IGP development team in IETF proposed RFC 2328 in 1988 for IPv4 routing protocols.\nAt the time, because the RIP single path could only support up to 15 network devices, the RIP routing protocol was not suitable for large network environments, so the IGRP routing protocol was developed, and the OSPF protocol was developed at the same time.\nCurrently, OSPF is divided into two versions:\nOSPF v2 (IPv4) OSPF v3 (IPv6) Topology Design The concept is as follows:\nEstablish BGP sessions with others on different core routers. Establish OSPF connections with other POPs. Once the route enters from any core of a POP, it will automatically route through the learned routes from OSPF.\n","wordCount":"284","inLanguage":"en","datePublished":"2021-05-16T22:17:25+08:00","dateModified":"2021-05-16T22:17:25+08:00","author":{"@type":"Person","name":"SteveYi"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.steveyi.net/en/posts/ospf-and-bgp/"},"publisher":{"@type":"Organization","name":"SteveYi's Blog","logo":{"@type":"ImageObject","url":"https://blog.steveyi.net/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.steveyi.net/en/ accesskey=h title="SteveYi's Blog (Alt + H)">SteveYi's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://blog.steveyi.net/ title=正體中文 aria-label=正體中文>Tw</a></li></ul></div></div><ul id=menu><li><a href=https://blog.steveyi.net/en/ title="Home Page"><span>Home</span></a></li><li><a href=https://blog.steveyi.net/en/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://blog.steveyi.net/en/about/ title=關於小易><span>About</span></a></li><li><a href=https://twitter.com/cool_small_yi title=Twitter><span>Twitter</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Optimizing Intranet with OSPF and BGP</h1><div class=post-meta><span title='2021-05-16 22:17:25 +0800 +0800'>2021-05-16</span>&nbsp;·&nbsp;SteveYi&nbsp;|&nbsp;Translations:<ul class=i18n_list><li><a href=https://blog.steveyi.net/posts/ospf-and-bgp/>Tw</a></li></ul></div></header><div class=post-content><p>For a long time, my friends and I have had an intranet similar to DN42. We use VPN to establish BGP connections and deploy this intranet using various devices in different areas.<br>P.S. Currently, there are about 46 routes.</p><p><img loading=lazy src=https://static-a1.steveyi.net/media/blog/1621242200.png alt></p><p>Currently, I am building a BGP peer with other people from one point and using static routes to handle internal routing.</p><p>For example, if the device <code>10.121.23.242</code> wants to reach a device <code>10.121.210.3</code> on my intranet:</p><p><img loading=lazy src=https://static-a1.steveyi.net/media/blog/1621238898.png alt></p><p>For example, I set up a route <code>10.121.210.0/24</code> on the core router to the router placed in the school. On the school router, I established a BGP peer with the core router to receive the full table of our intranet.</p><p><img loading=lazy src=https://static-a1.steveyi.net/media/blog/1621244817.png alt></p><p>This can make our network work, but when the core router fails, others cannot enter my intranet.</p><p>So I thought of using OSPF and iBGP to solve the problem of a single core router failure.</p><h2 id=what-is-ospf>What is OSPF?<a hidden class=anchor aria-hidden=true href=#what-is-ospf>#</a></h2><p>OSPF, short for Open Shortest Path First, is an IGP protocol that uses Link State Routing algorithm.</p><p>The IGP development team in IETF proposed <a href=https://datatracker.ietf.org/doc/html/rfc2328>RFC 2328</a> in 1988 for IPv4 routing protocols.</p><p>At the time, because the RIP single path could only support up to 15 network devices, the RIP routing protocol was not suitable for large network environments, so the IGRP routing protocol was developed, and the OSPF protocol was developed at the same time.</p><p>Currently, OSPF is divided into two versions:</p><ul><li><a href=https://datatracker.ietf.org/doc/html/rfc2328>OSPF v2</a> (IPv4)</li><li><a href=https://datatracker.ietf.org/doc/html/rfc5340>OSPF v3</a> (IPv6)</li></ul><h2 id=topology-design>Topology Design<a hidden class=anchor aria-hidden=true href=#topology-design>#</a></h2><p>The concept is as follows:</p><ol><li>Establish BGP sessions with others on different core routers.</li><li>Establish OSPF connections with other POPs.</li></ol><p>Once the route enters from any core of a POP, it will automatically route through the learned routes from OSPF.</p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://blog.steveyi.net/en/>SteveYi's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>