<!doctype html><html lang=tw dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>利用 OSPF 及 BGP 來最佳化大內網 | 小易的部落格</title><meta name=keywords content="網路"><meta name=description content="一直一來，我跟朋友間有一個類似於 DN42 的大內網。
我們使用 VPN 建立 BGP 互聯，並將這個大內網部署於我各個區域的設備使用。
P.S. 目前共有 46 條路由左右
而我目前則是在一個點與其他人建立 BGP Peer，並使用 Static Route 處理內部路由
e.g. 10.121.23.242 的設備想要到我的內網下的某台設備 10.121.210.3
比如說，我在核心路由器上指一條 10.121.210.0/24 到我放在學校的路由器上。
而在學校的路由器上，我則與核心路由器建立了 BGP Peer，來收我們的大內網全表。
這樣確實可以讓我們的網路動，但是當核心路由器故障時，其他人則無法進到我的內網。
於是我想到，我可以使用 OSPF 及 iBGP 去解決單一核心路由器故障的問題
什麼是 OSPF？ OSPF 全名 Open Shortest Path First，是一種 IGP 協議，使用 Link State Routing 算法。
IETF 中的 IGP 開發團隊在 1988 年提出 RFC 2328，用於 IPv4 的路由協定。
在當時，由於 RIP 單一路徑最多只能支 15 個網路設備，所以 RIP 路由協定在當時並不適合用於大型的網路環境，所以才會研發 IGRP 路由協定，並且同時開發出 OSPF 協定。
目前 OSPF 分為兩種版本："><meta name=author content="SteveYi"><link rel=canonical href=https://blog.steveyi.net/posts/ospf-and-bgp/><link crossorigin=anonymous href=/assets/css/stylesheet.bccfefac377bc340f06c260aed1bddf49a4354816d7c570d6aac75a997986c95.css integrity="sha256-vM/vrDd7w0DwbCYK7Rvd9JpDVIFtfFcNaqx1qZeYbJU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.steveyi.net/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.steveyi.net/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.steveyi.net/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.steveyi.net/apple-touch-icon.png><link rel=mask-icon href=https://blog.steveyi.net/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.steveyi.net/en/posts/ospf-and-bgp/><link rel=alternate hreflang=tw href=https://blog.steveyi.net/posts/ospf-and-bgp/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-CPGWT2M3VT"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-CPGWT2M3VT",{anonymize_ip:!1})}</script><meta property="og:title" content="利用 OSPF 及 BGP 來最佳化大內網"><meta property="og:description" content="一直一來，我跟朋友間有一個類似於 DN42 的大內網。
我們使用 VPN 建立 BGP 互聯，並將這個大內網部署於我各個區域的設備使用。
P.S. 目前共有 46 條路由左右
而我目前則是在一個點與其他人建立 BGP Peer，並使用 Static Route 處理內部路由
e.g. 10.121.23.242 的設備想要到我的內網下的某台設備 10.121.210.3
比如說，我在核心路由器上指一條 10.121.210.0/24 到我放在學校的路由器上。
而在學校的路由器上，我則與核心路由器建立了 BGP Peer，來收我們的大內網全表。
這樣確實可以讓我們的網路動，但是當核心路由器故障時，其他人則無法進到我的內網。
於是我想到，我可以使用 OSPF 及 iBGP 去解決單一核心路由器故障的問題
什麼是 OSPF？ OSPF 全名 Open Shortest Path First，是一種 IGP 協議，使用 Link State Routing 算法。
IETF 中的 IGP 開發團隊在 1988 年提出 RFC 2328，用於 IPv4 的路由協定。
在當時，由於 RIP 單一路徑最多只能支 15 個網路設備，所以 RIP 路由協定在當時並不適合用於大型的網路環境，所以才會研發 IGRP 路由協定，並且同時開發出 OSPF 協定。
目前 OSPF 分為兩種版本："><meta property="og:type" content="article"><meta property="og:url" content="https://blog.steveyi.net/posts/ospf-and-bgp/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-05-16T22:17:25+08:00"><meta property="article:modified_time" content="2021-05-16T22:17:25+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="利用 OSPF 及 BGP 來最佳化大內網"><meta name=twitter:description content="一直一來，我跟朋友間有一個類似於 DN42 的大內網。
我們使用 VPN 建立 BGP 互聯，並將這個大內網部署於我各個區域的設備使用。
P.S. 目前共有 46 條路由左右
而我目前則是在一個點與其他人建立 BGP Peer，並使用 Static Route 處理內部路由
e.g. 10.121.23.242 的設備想要到我的內網下的某台設備 10.121.210.3
比如說，我在核心路由器上指一條 10.121.210.0/24 到我放在學校的路由器上。
而在學校的路由器上，我則與核心路由器建立了 BGP Peer，來收我們的大內網全表。
這樣確實可以讓我們的網路動，但是當核心路由器故障時，其他人則無法進到我的內網。
於是我想到，我可以使用 OSPF 及 iBGP 去解決單一核心路由器故障的問題
什麼是 OSPF？ OSPF 全名 Open Shortest Path First，是一種 IGP 協議，使用 Link State Routing 算法。
IETF 中的 IGP 開發團隊在 1988 年提出 RFC 2328，用於 IPv4 的路由協定。
在當時，由於 RIP 單一路徑最多只能支 15 個網路設備，所以 RIP 路由協定在當時並不適合用於大型的網路環境，所以才會研發 IGRP 路由協定，並且同時開發出 OSPF 協定。
目前 OSPF 分為兩種版本："><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.steveyi.net/posts/"},{"@type":"ListItem","position":2,"name":"利用 OSPF 及 BGP 來最佳化大內網","item":"https://blog.steveyi.net/posts/ospf-and-bgp/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"利用 OSPF 及 BGP 來最佳化大內網","name":"利用 OSPF 及 BGP 來最佳化大內網","description":"一直一來，我跟朋友間有一個類似於 DN42 的大內網。\n我們使用 VPN 建立 BGP 互聯，並將這個大內網部署於我各個區域的設備使用。\nP.S. 目前共有 46 條路由左右\n而我目前則是在一個點與其他人建立 BGP Peer，並使用 Static Route 處理內部路由\ne.g. 10.121.23.242 的設備想要到我的內網下的某台設備 10.121.210.3\n比如說，我在核心路由器上指一條 10.121.210.0/24 到我放在學校的路由器上。\n而在學校的路由器上，我則與核心路由器建立了 BGP Peer，來收我們的大內網全表。\n這樣確實可以讓我們的網路動，但是當核心路由器故障時，其他人則無法進到我的內網。\n於是我想到，我可以使用 OSPF 及 iBGP 去解決單一核心路由器故障的問題\n什麼是 OSPF？ OSPF 全名 Open Shortest Path First，是一種 IGP 協議，使用 Link State Routing 算法。\nIETF 中的 IGP 開發團隊在 1988 年提出 RFC 2328，用於 IPv4 的路由協定。\n在當時，由於 RIP 單一路徑最多只能支 15 個網路設備，所以 RIP 路由協定在當時並不適合用於大型的網路環境，所以才會研發 IGRP 路由協定，並且同時開發出 OSPF 協定。\n目前 OSPF 分為兩種版本：","keywords":["網路"],"articleBody":"一直一來，我跟朋友間有一個類似於 DN42 的大內網。\n我們使用 VPN 建立 BGP 互聯，並將這個大內網部署於我各個區域的設備使用。\nP.S. 目前共有 46 條路由左右\n而我目前則是在一個點與其他人建立 BGP Peer，並使用 Static Route 處理內部路由\ne.g. 10.121.23.242 的設備想要到我的內網下的某台設備 10.121.210.3\n比如說，我在核心路由器上指一條 10.121.210.0/24 到我放在學校的路由器上。\n而在學校的路由器上，我則與核心路由器建立了 BGP Peer，來收我們的大內網全表。\n這樣確實可以讓我們的網路動，但是當核心路由器故障時，其他人則無法進到我的內網。\n於是我想到，我可以使用 OSPF 及 iBGP 去解決單一核心路由器故障的問題\n什麼是 OSPF？ OSPF 全名 Open Shortest Path First，是一種 IGP 協議，使用 Link State Routing 算法。\nIETF 中的 IGP 開發團隊在 1988 年提出 RFC 2328，用於 IPv4 的路由協定。\n在當時，由於 RIP 單一路徑最多只能支 15 個網路設備，所以 RIP 路由協定在當時並不適合用於大型的網路環境，所以才會研發 IGRP 路由協定，並且同時開發出 OSPF 協定。\n目前 OSPF 分為兩種版本：\nOSPF v2 (IPv4) OSPF v3 (IPv6) 拓樸設計 概念是這樣的：\n在不同的核心路由器與別人建立 BGP Session 與自己其他 POP 建立 OSPF 連接。 一但路由從任一個 POP 的核心進入後，會自動透過 OSPF 學習到的路由來路由。\n","wordCount":"93","inLanguage":"tw","datePublished":"2021-05-16T22:17:25+08:00","dateModified":"2021-05-16T22:17:25+08:00","author":{"@type":"Person","name":"SteveYi"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.steveyi.net/posts/ospf-and-bgp/"},"publisher":{"@type":"Organization","name":"小易的部落格","logo":{"@type":"ImageObject","url":"https://blog.steveyi.net/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.steveyi.net/ accesskey=h title="小易的部落格 (Alt + H)">小易的部落格</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://blog.steveyi.net/en/ title=English aria-label=English>En</a></li></ul></div></div><ul id=menu><li><a href=https://blog.steveyi.net/ title=首頁><span>首頁</span></a></li><li><a href=https://blog.steveyi.net/posts/ title=文章列表><span>文章列表</span></a></li><li><a href=https://blog.steveyi.net/about/ title=關於小易><span>關於小易</span></a></li><li><a href=https://twitter.com/steveyiyo title=Twitter><span>Twitter</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>利用 OSPF 及 BGP 來最佳化大內網</h1><div class=post-meta><span title='2021-05-16 22:17:25 +0800 +0800'>2021-05-16</span>&nbsp;·&nbsp;SteveYi&nbsp;|&nbsp;Translations:<ul class=i18n_list><li><a href=https://blog.steveyi.net/en/posts/ospf-and-bgp/>En</a></li></ul></div></header><div class=post-content><p>一直一來，我跟朋友間有一個類似於 DN42 的大內網。</p><p>我們使用 VPN 建立 BGP 互聯，並將這個大內網部署於我各個區域的設備使用。<br>P.S. 目前共有 46 條路由左右</p><p><img loading=lazy src=https://static-a1.steveyi.net/media/blog/1621242200.png alt></p><p>而我目前則是在一個點與其他人建立 <strong>BGP Peer</strong>，並使用 <strong>Static Route</strong> 處理內部路由</p><p>e.g. <code>10.121.23.242</code> 的設備想要到我的內網下的某台設備 <code>10.121.210.3</code></p><p><img loading=lazy src=https://static-a1.steveyi.net/media/blog/1621238898.png alt></p><p>比如說，我在核心路由器上指一條 <code>10.121.210.0/24</code> 到我放在學校的路由器上。<br>而在學校的路由器上，我則與核心路由器建立了 BGP Peer，來收我們的大內網全表。</p><p><img loading=lazy src=https://static-a1.steveyi.net/media/blog/1621244817.png alt></p><p>這樣確實可以讓我們的網路動，但是當核心路由器故障時，其他人則無法進到我的內網。</p><p>於是我想到，我可以使用 OSPF 及 iBGP 去解決單一核心路由器故障的問題</p><h2 id=什麼是-ospf>什麼是 OSPF？<a hidden class=anchor aria-hidden=true href=#什麼是-ospf>#</a></h2><p>OSPF 全名 Open Shortest Path First，是一種 IGP 協議，使用 Link State Routing 算法。</p><p>IETF 中的 IGP 開發團隊在 1988 年提出 <a href=https://datatracker.ietf.org/doc/html/rfc2328>RFC 2328</a>，用於 IPv4 的路由協定。</p><p>在當時，由於 RIP 單一路徑最多只能支 15 個網路設備，所以 RIP 路由協定在當時並不適合用於大型的網路環境，所以才會研發 IGRP 路由協定，並且同時開發出 OSPF 協定。</p><p>目前 OSPF 分為兩種版本：</p><ul><li><a href=https://datatracker.ietf.org/doc/html/rfc2328>OSPF v2</a> (IPv4)</li><li><a href=https://datatracker.ietf.org/doc/html/rfc5340>OSPF v3</a> (IPv6)</li></ul><h2 id=拓樸設計>拓樸設計<a hidden class=anchor aria-hidden=true href=#拓樸設計>#</a></h2><p>概念是這樣的：</p><ol><li>在不同的核心路由器與別人建立 BGP Session</li><li>與自己其他 POP 建立 OSPF 連接。</li></ol><p>一但路由從任一個 POP 的核心進入後，會自動透過 OSPF 學習到的路由來路由。</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.steveyi.net/tags/%E7%B6%B2%E8%B7%AF/>網路</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://blog.steveyi.net/>小易的部落格</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>