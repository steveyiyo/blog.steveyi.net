<!doctype html><html lang=tw dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Backblaze B2 搭配 Cloudflare Workers 設定自訂網域名稱 | 小易的部落格</title><meta name=keywords content="伺服器,網站日誌,CDN"><meta name=description content="當初架設網站的時候，考量到了圖片的存儲以及流量的問題。
本來是將圖片跟網站放在同一個網站伺服器下的，但後來發現伺服器空間常常不足夠（因為系統會自動備份，導致空間不足）
後來將圖片放在 OneDrive 商業版，並搭配 OneList 來使用，但畢竟是非官方的API，當API請求速率過快，圖片就載入不出來了．
當初 OneDrive 失敗後，又將圖片放到 Google Drive 上，並搭配 rclone 使用，
但是&mldr; 網站載入爆慢呀！（而且流量也爆了）
最後就發現 Backblaze B2 這個東西了 XD
Backblaze 是什麼? Backblaze 是一家數據存儲提供商，提供兩種產品：
B2 Cloud Storage 是一種類似於 Amazon S3 的對象存儲服務，主打低價，並且搭配 Cloudflare CDN 的 egree 流量為免費！ Cloud Backup 則是無限空間的電腦備份服務。 如果有興趣了解更多內容的話，可以參考 Backblaze官網。
需要運用到的資源 Cloudflare CDN Cloudflare DNS Cloudflare Workers Backblaze B2 教學開始 1.首先，進入 Cloudflare 後，點擊 + Add a Site 來新增一個網域
2.新增完成之後，我們點擊右方的 Workers 來進入Cloudflare Workers
接著我們點擊上方的 Create a Worker 來建立一個新的 Worker"><meta name=author content="SteveYi"><link rel=canonical href=https://blog.steveyi.net/posts/b2-cfworkers/><link crossorigin=anonymous href=/assets/css/stylesheet.bccfefac377bc340f06c260aed1bddf49a4354816d7c570d6aac75a997986c95.css integrity="sha256-vM/vrDd7w0DwbCYK7Rvd9JpDVIFtfFcNaqx1qZeYbJU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.steveyi.net/images/me.png><link rel=icon type=image/png sizes=16x16 href=https://blog.steveyi.net/images/me.png><link rel=icon type=image/png sizes=32x32 href=https://blog.steveyi.net/images/me.png><link rel=apple-touch-icon href=https://blog.steveyi.net/images/me.png><link rel=mask-icon href=https://blog.steveyi.net/images/me.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.steveyi.net/en/posts/b2-cfworkers/><link rel=alternate hreflang=tw href=https://blog.steveyi.net/posts/b2-cfworkers/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-CPGWT2M3VT"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-CPGWT2M3VT",{anonymize_ip:!1})}</script><meta property="og:title" content="Backblaze B2 搭配 Cloudflare Workers 設定自訂網域名稱"><meta property="og:description" content="當初架設網站的時候，考量到了圖片的存儲以及流量的問題。
本來是將圖片跟網站放在同一個網站伺服器下的，但後來發現伺服器空間常常不足夠（因為系統會自動備份，導致空間不足）
後來將圖片放在 OneDrive 商業版，並搭配 OneList 來使用，但畢竟是非官方的API，當API請求速率過快，圖片就載入不出來了．
當初 OneDrive 失敗後，又將圖片放到 Google Drive 上，並搭配 rclone 使用，
但是&mldr; 網站載入爆慢呀！（而且流量也爆了）
最後就發現 Backblaze B2 這個東西了 XD
Backblaze 是什麼? Backblaze 是一家數據存儲提供商，提供兩種產品：
B2 Cloud Storage 是一種類似於 Amazon S3 的對象存儲服務，主打低價，並且搭配 Cloudflare CDN 的 egree 流量為免費！ Cloud Backup 則是無限空間的電腦備份服務。 如果有興趣了解更多內容的話，可以參考 Backblaze官網。
需要運用到的資源 Cloudflare CDN Cloudflare DNS Cloudflare Workers Backblaze B2 教學開始 1.首先，進入 Cloudflare 後，點擊 + Add a Site 來新增一個網域
2.新增完成之後，我們點擊右方的 Workers 來進入Cloudflare Workers
接著我們點擊上方的 Create a Worker 來建立一個新的 Worker"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.steveyi.net/posts/b2-cfworkers/"><meta property="og:image" content="https://blog.steveyi.net/images/banner.webp"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-02-26T20:36:28+00:00"><meta property="article:modified_time" content="2020-02-26T20:36:28+00:00"><meta property="og:site_name" content="SteveYi's Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.steveyi.net/images/banner.webp"><meta name=twitter:title content="Backblaze B2 搭配 Cloudflare Workers 設定自訂網域名稱"><meta name=twitter:description content="當初架設網站的時候，考量到了圖片的存儲以及流量的問題。
本來是將圖片跟網站放在同一個網站伺服器下的，但後來發現伺服器空間常常不足夠（因為系統會自動備份，導致空間不足）
後來將圖片放在 OneDrive 商業版，並搭配 OneList 來使用，但畢竟是非官方的API，當API請求速率過快，圖片就載入不出來了．
當初 OneDrive 失敗後，又將圖片放到 Google Drive 上，並搭配 rclone 使用，
但是&mldr; 網站載入爆慢呀！（而且流量也爆了）
最後就發現 Backblaze B2 這個東西了 XD
Backblaze 是什麼? Backblaze 是一家數據存儲提供商，提供兩種產品：
B2 Cloud Storage 是一種類似於 Amazon S3 的對象存儲服務，主打低價，並且搭配 Cloudflare CDN 的 egree 流量為免費！ Cloud Backup 則是無限空間的電腦備份服務。 如果有興趣了解更多內容的話，可以參考 Backblaze官網。
需要運用到的資源 Cloudflare CDN Cloudflare DNS Cloudflare Workers Backblaze B2 教學開始 1.首先，進入 Cloudflare 後，點擊 + Add a Site 來新增一個網域
2.新增完成之後，我們點擊右方的 Workers 來進入Cloudflare Workers
接著我們點擊上方的 Create a Worker 來建立一個新的 Worker"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.steveyi.net/posts/"},{"@type":"ListItem","position":2,"name":"Backblaze B2 搭配 Cloudflare Workers 設定自訂網域名稱","item":"https://blog.steveyi.net/posts/b2-cfworkers/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Backblaze B2 搭配 Cloudflare Workers 設定自訂網域名稱","name":"Backblaze B2 搭配 Cloudflare Workers 設定自訂網域名稱","description":"當初架設網站的時候，考量到了圖片的存儲以及流量的問題。\n本來是將圖片跟網站放在同一個網站伺服器下的，但後來發現伺服器空間常常不足夠（因為系統會自動備份，導致空間不足）\n後來將圖片放在 OneDrive 商業版，並搭配 OneList 來使用，但畢竟是非官方的API，當API請求速率過快，圖片就載入不出來了．\n當初 OneDrive 失敗後，又將圖片放到 Google Drive 上，並搭配 rclone 使用，\n但是\u0026hellip; 網站載入爆慢呀！（而且流量也爆了）\n最後就發現 Backblaze B2 這個東西了 XD\nBackblaze 是什麼? Backblaze 是一家數據存儲提供商，提供兩種產品：\nB2 Cloud Storage 是一種類似於 Amazon S3 的對象存儲服務，主打低價，並且搭配 Cloudflare CDN 的 egree 流量為免費！ Cloud Backup 則是無限空間的電腦備份服務。 如果有興趣了解更多內容的話，可以參考 Backblaze官網。\n需要運用到的資源 Cloudflare CDN Cloudflare DNS Cloudflare Workers Backblaze B2 教學開始 1.首先，進入 Cloudflare 後，點擊 + Add a Site 來新增一個網域\n2.新增完成之後，我們點擊右方的 Workers 來進入Cloudflare Workers\n接著我們點擊上方的 Create a Worker 來建立一個新的 Worker","keywords":["伺服器","網站日誌","CDN"],"articleBody":"當初架設網站的時候，考量到了圖片的存儲以及流量的問題。\n本來是將圖片跟網站放在同一個網站伺服器下的，但後來發現伺服器空間常常不足夠（因為系統會自動備份，導致空間不足）\n後來將圖片放在 OneDrive 商業版，並搭配 OneList 來使用，但畢竟是非官方的API，當API請求速率過快，圖片就載入不出來了．\n當初 OneDrive 失敗後，又將圖片放到 Google Drive 上，並搭配 rclone 使用，\n但是… 網站載入爆慢呀！（而且流量也爆了）\n最後就發現 Backblaze B2 這個東西了 XD\nBackblaze 是什麼? Backblaze 是一家數據存儲提供商，提供兩種產品：\nB2 Cloud Storage 是一種類似於 Amazon S3 的對象存儲服務，主打低價，並且搭配 Cloudflare CDN 的 egree 流量為免費！ Cloud Backup 則是無限空間的電腦備份服務。 如果有興趣了解更多內容的話，可以參考 Backblaze官網。\n需要運用到的資源 Cloudflare CDN Cloudflare DNS Cloudflare Workers Backblaze B2 教學開始 1.首先，進入 Cloudflare 後，點擊 + Add a Site 來新增一個網域\n2.新增完成之後，我們點擊右方的 Workers 來進入Cloudflare Workers\n接著我們點擊上方的 Create a Worker 來建立一個新的 Worker\n3.將文章下方的程式碼貼到左邊的 Script，並修改以下三個參數：\nb2Domain b2Bucket b2UrlPath 完成後我們點擊下方的 Save and Deploy。\n4.接著我們進入剛剛新增好的網域\n新增一個 CNAME 紀錄（下方是 A 紀錄… 忘了改 xDD）\n5.新增 CNAME 紀錄後，我們點擊上方的 Workers\n接著點擊 Add route\n6.接著這邊我們來設定一下\nRoute 的部分填寫 剛剛新增的子網域/* e.g. img.steveyi.net/* Worker 選擇剛剛新增的 Worker 這樣就大功告成啦！\nCloudflare Workers 程式碼 程式碼作者 / 來源\n'use strict'; const b2Domain = 'static-a1.steveyi.net'; //你要在 Cloudflare 上綁定的 Backblaze 網域 const b2Bucket = ''; //Backblaze B2 的存儲桶名稱 const b2UrlPath = `/file/${b2Bucket}/`; addEventListener('fetch', event =\u003e { return event.respondWith(fileReq(event)); }); // define the file extensions we wish to add basic access control headers to const corsFileTypes = ['png', 'jpg', 'gif', 'jpeg', 'webp']; // backblaze returns some additional headers that are useful for debugging, but unnecessary in production. We can remove these to save some size const removeHeaders = [ 'x-bz-content-sha1', 'x-bz-file-id', 'x-bz-file-name', 'x-bz-info-src_last_modified_millis', 'X-Bz-Upload-Timestamp', 'Expires' ]; const expiration = 31536000; // override browser cache for images - 1 year // define a function we can re-use to fix headers const fixHeaders = function(url, status, headers) { let newHdrs = new Headers(headers); // add basic cors headers for images if (corsFileTypes.includes(url.pathname.split('.').pop())) { newHdrs.set('Access-Control-Allow-Origin', '*'); } // override browser cache for files when 200 if (status === 200) { newHdrs.set('Cache-Control', \"public, max-age=\" + expiration); } else { // only cache other things for 5 minutes newHdrs.set('Cache-Control', 'public, max-age=300'); } // set ETag for efficient caching where possible const ETag = newHdrs.get('x-bz-content-sha1') || newHdrs.get('x-bz-info-src_last_modified_millis') || newHdrs.get('x-bz-file-id'); if (ETag) { newHdrs.set('ETag', ETag); } // remove unnecessary headers removeHeaders.forEach(header =\u003e { newHdrs.delete(header); }); return newHdrs; }; async function fileReq(event) { const cache = caches.default; // Cloudflare edge caching const url = new URL(event.request.url); if (url.host === b2Domain \u0026\u0026 !url.pathname.startsWith(b2UrlPath)) { url.pathname = b2UrlPath + url.pathname; } let response = await cache.match(url); // try to find match for this request in the edge cache if (response) { // use cache found on Cloudflare edge. Set X-Worker-Cache header for helpful debug let newHdrs = fixHeaders(url, response.status, response.headers); newHdrs.set('X-Worker-Cache', \"true\"); return new Response(response.body, { status: response.status, statusText: response.statusText, headers: newHdrs }); } // no cache, fetch image, apply Cloudflare lossless compression response = await fetch(url, { cf: { polish: \"lossless\" } }); let newHdrs = fixHeaders(url, response.status, response.headers); if (response.status === 200) { response = new Response(response.body, { status: response.status, statusText: response.statusText, headers: newHdrs }); } else { // 可以返回 404 的 HTML response = new Response(` \u003c!DOCTYPE html\u003e 你來到了一個錯誤頁面 404 糟糕! 我們好像找不到檔案或頁面！ 抱歉，您要查找的檔案或頁面不存在，可能被刪除或是暫時不可使用\n回到主頁 `, { headers: { 'content-type': 'text/html;charset=UTF-8', }, status: 404 }) } event.waitUntil(cache.put(url, response.clone())); return response; } Refence: Using Backblaze B2 and Cloudflare Workers for free image hosting Bandwidth Alliance | BACKBLAZE Backblaze and Cloudflare Partner to Provide Free Data Transfer ","wordCount":"734","inLanguage":"tw","datePublished":"2020-02-26T20:36:28Z","dateModified":"2020-02-26T20:36:28Z","author":{"@type":"Person","name":"SteveYi"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.steveyi.net/posts/b2-cfworkers/"},"publisher":{"@type":"Organization","name":"小易的部落格","logo":{"@type":"ImageObject","url":"https://blog.steveyi.net/images/me.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.steveyi.net/ accesskey=h title="小易的部落格 (Alt + H)">小易的部落格</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://blog.steveyi.net/en/ title=English aria-label=English>En</a></li></ul></div></div><ul id=menu><li><a href=https://blog.steveyi.net/ title=首頁><span>首頁</span></a></li><li><a href=https://blog.steveyi.net/posts/ title=文章列表><span>文章列表</span></a></li><li><a href=https://steveyi.net/ title=關於小易><span>關於小易</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://x.com/steveyiyo title="X (Twitter)"><span>X (Twitter)</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Backblaze B2 搭配 Cloudflare Workers 設定自訂網域名稱</h1><div class=post-meta><span title='2020-02-26 20:36:28 +0000 UTC'>February 26, 2020</span>&nbsp;·&nbsp;SteveYi&nbsp;|&nbsp;Translations:<ul class=i18n_list><li><a href=https://blog.steveyi.net/en/posts/b2-cfworkers/>En</a></li></ul></div></header><div class=post-content><p>當初架設網站的時候，考量到了圖片的存儲以及流量的問題。</p><p>本來是將圖片跟網站放在同一個網站伺服器下的，但後來發現伺服器空間常常不足夠（因為系統會自動備份，導致空間不足）</p><p>後來將圖片放在 <a href=https://onedrive.com>OneDrive</a> 商業版，並搭配 <a href=https://github.com/MoeClub/OneList/>OneList</a> 來使用，但畢竟是非官方的API，當API請求速率過快，圖片就載入不出來了．</p><p>當初 <a href=https://onedrive.com>OneDrive</a> 失敗後，又將圖片放到 <a href=https://drive.google.com>Google Drive</a> 上，並搭配 <a href=https://rclone.org>rclone</a> 使用，<br>但是&mldr; 網站載入爆慢呀！（而且流量也爆了）<br>最後就發現 <a href=https://www.backblaze.com/b2/cloud-storage.html>Backblaze B2</a> 這個東西了 XD</p><h1 id=backblaze-是什麼>Backblaze 是什麼?<a hidden class=anchor aria-hidden=true href=#backblaze-是什麼>#</a></h1><p>Backblaze 是一家數據存儲提供商，提供兩種產品：</p><ul><li><a href=https://www.backblaze.com/b2/cloud-storage.html>B2 Cloud Storage</a> 是一種類似於 Amazon S3 的對象存儲服務，主打低價，並且搭配 Cloudflare CDN 的 egree 流量為免費！</li><li><a href=https://www.backblaze.com/cloud-backup.html>Cloud Backup</a> 則是無限空間的電腦備份服務。</li></ul><p>如果有興趣了解更多內容的話，可以參考 <a href=https://www.backblaze.com>Backblaze官網</a>。</p><h1 id=需要運用到的資源>需要運用到的資源<a hidden class=anchor aria-hidden=true href=#需要運用到的資源>#</a></h1><ul><li>Cloudflare CDN</li><li>Cloudflare DNS</li><li>Cloudflare Workers</li><li>Backblaze B2</li></ul><h1 id=教學開始>教學開始<a hidden class=anchor aria-hidden=true href=#教學開始>#</a></h1><p>1.首先，進入 Cloudflare 後，點擊 <code>+ Add a Site</code> 來新增一個網域</p><p><img loading=lazy src=https://static-a1.steveyi.net/media/blog/2020/04/B2-CFWorkers-01-1920x1082.png alt></p><p>2.新增完成之後，我們點擊右方的 Workers 來進入Cloudflare Workers<br>接著我們點擊上方的 Create a Worker 來建立一個新的 Worker</p><p><img loading=lazy src=https://static-a1.steveyi.net/media/blog/2020/04/B2-CFWorkers-02-1920x407.png alt></p><p>3.將文章下方的程式碼貼到左邊的 Script，並修改以下三個參數：</p><ul><li>b2Domain</li><li>b2Bucket</li><li>b2UrlPath</li></ul><p>完成後我們點擊下方的 Save and Deploy。</p><p><img loading=lazy src=https://static-a1.steveyi.net/media/blog/2020/04/B2-CFWorkers-03-1920x967.png alt></p><p>4.接著我們進入剛剛新增好的網域<br>新增一個 CNAME 紀錄（下方是 A 紀錄&mldr; 忘了改 xDD）</p><p><img loading=lazy src=https://static-a1.steveyi.net/media/blog/2020/04/B2-CFWorkers-04-1920x469.png alt></p><p>5.新增 CNAME 紀錄後，我們點擊上方的 Workers<br>接著點擊 Add route</p><p><img loading=lazy src=https://static-a1.steveyi.net/media/blog/2020/04/B2-CFWorkers-05-1920x693.png alt></p><p>6.接著這邊我們來設定一下</p><ol><li>Route 的部分填寫 <code>剛剛新增的子網域/*</code>
e.g. <code>img.steveyi.net/*</code></li><li>Worker 選擇剛剛新增的 Worker</li></ol><p><img loading=lazy src=https://static-a1.steveyi.net/media/blog/2020/04/B2-CFWorkers-06.png alt></p><p>這樣就大功告成啦！</p><h1 id=cloudflare-workers-程式碼>Cloudflare Workers 程式碼<a hidden class=anchor aria-hidden=true href=#cloudflare-workers-程式碼>#</a></h1><p><a href=https://jross.me/free-personal-image-hosting-with-backblaze-b2-and-cloudflare-workers/>程式碼作者 / 來源</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#e6db74>&#39;use strict&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>b2Domain</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;static-a1.steveyi.net&#39;</span>; <span style=color:#75715e>//你要在 Cloudflare 上綁定的 Backblaze 網域
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>b2Bucket</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>; <span style=color:#75715e>//Backblaze B2 的存儲桶名稱
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>b2UrlPath</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`/file/</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>b2Bucket</span><span style=color:#e6db74>}</span><span style=color:#e6db74>/`</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#39;fetch&#39;</span>, <span style=color:#a6e22e>event</span> =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>respondWith</span>(<span style=color:#a6e22e>fileReq</span>(<span style=color:#a6e22e>event</span>));
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// define the file extensions we wish to add basic access control headers to
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>corsFileTypes</span> <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;png&#39;</span>, <span style=color:#e6db74>&#39;jpg&#39;</span>, <span style=color:#e6db74>&#39;gif&#39;</span>, <span style=color:#e6db74>&#39;jpeg&#39;</span>, <span style=color:#e6db74>&#39;webp&#39;</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// backblaze returns some additional headers that are useful for debugging, but unnecessary in production. We can remove these to save some size
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>removeHeaders</span> <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;x-bz-content-sha1&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;x-bz-file-id&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;x-bz-file-name&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;x-bz-info-src_last_modified_millis&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;X-Bz-Upload-Timestamp&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;Expires&#39;</span>
</span></span><span style=display:flex><span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>expiration</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>31536000</span>; <span style=color:#75715e>// override browser cache for images - 1 year
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// define a function we can re-use to fix headers
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>fixHeaders</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>url</span>, <span style=color:#a6e22e>status</span>, <span style=color:#a6e22e>headers</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>newHdrs</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Headers</span>(<span style=color:#a6e22e>headers</span>);
</span></span><span style=display:flex><span>    <span style=color:#75715e>// add basic cors headers for images
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>corsFileTypes</span>.<span style=color:#a6e22e>includes</span>(<span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>pathname</span>.<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#39;.&#39;</span>).<span style=color:#a6e22e>pop</span>())) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>newHdrs</span>.<span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#39;Access-Control-Allow-Origin&#39;</span>, <span style=color:#e6db74>&#39;*&#39;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// override browser cache for files when 200
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>status</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>200</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>newHdrs</span>.<span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#39;Cache-Control&#39;</span>, <span style=color:#e6db74>&#34;public, max-age=&#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>expiration</span>);
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// only cache other things for 5 minutes
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>newHdrs</span>.<span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#39;Cache-Control&#39;</span>, <span style=color:#e6db74>&#39;public, max-age=300&#39;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// set ETag for efficient caching where possible
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>ETag</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>newHdrs</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;x-bz-content-sha1&#39;</span>) <span style=color:#f92672>||</span> <span style=color:#a6e22e>newHdrs</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;x-bz-info-src_last_modified_millis&#39;</span>) <span style=color:#f92672>||</span> <span style=color:#a6e22e>newHdrs</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;x-bz-file-id&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>ETag</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>newHdrs</span>.<span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#39;ETag&#39;</span>, <span style=color:#a6e22e>ETag</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// remove unnecessary headers
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>removeHeaders</span>.<span style=color:#a6e22e>forEach</span>(<span style=color:#a6e22e>header</span> =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>newHdrs</span>.<span style=color:#66d9ef>delete</span>(<span style=color:#a6e22e>header</span>);
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>newHdrs</span>;
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>fileReq</span>(<span style=color:#a6e22e>event</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>cache</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>caches</span>.<span style=color:#66d9ef>default</span>; <span style=color:#75715e>// Cloudflare edge caching
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>url</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>URL</span>(<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>url</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>host</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>b2Domain</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span><span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>pathname</span>.<span style=color:#a6e22e>startsWith</span>(<span style=color:#a6e22e>b2UrlPath</span>)) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>pathname</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>b2UrlPath</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>pathname</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>cache</span>.<span style=color:#a6e22e>match</span>(<span style=color:#a6e22e>url</span>); <span style=color:#75715e>// try to find match for this request in the edge cache
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>response</span>) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// use cache found on Cloudflare edge. Set X-Worker-Cache header for helpful debug
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>newHdrs</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fixHeaders</span>(<span style=color:#a6e22e>url</span>, <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>status</span>, <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>headers</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>newHdrs</span>.<span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#39;X-Worker-Cache&#39;</span>, <span style=color:#e6db74>&#34;true&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Response</span>(<span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>body</span>, {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>status</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>status</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>statusText</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>statusText</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>newHdrs</span>
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// no cache, fetch image, apply Cloudflare lossless compression
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#a6e22e>url</span>, { <span style=color:#a6e22e>cf</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>polish</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;lossless&#34;</span> } });
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>newHdrs</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fixHeaders</span>(<span style=color:#a6e22e>url</span>, <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>status</span>, <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>headers</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>status</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>200</span>) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Response</span>(<span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>body</span>, {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>status</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>status</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>statusText</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>statusText</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>newHdrs</span>
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 可以返回 404 的 HTML
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Response</span>(<span style=color:#e6db74>`&lt;!--
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        SteveYi 個人網站
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        https://steveyi.net/
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Developed by SteveYi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        https://about.steveyi.net
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    --&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;!DOCTYPE html&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;html lang=&#34;en&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;head&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;meta charset=&#34;utf-8&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;meta http-equiv=&#34;X-UA-Compatible&#34; content=&#34;IE=edge&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;meta name=&#34;viewport&#34; content=&#34;width=device-width, initial-scale=1&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;link rel=&#34;shortcut icon&#34; href=&#34;https://static.yiy.tw/media/logo/Yi_logo.png&#34; type=&#34;images/x-icon&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;title&gt;你來到了一個錯誤頁面&lt;/title&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;link href=&#34;https://fonts.googleapis.com/css?family=Montserrat:500&#34; rel=&#34;stylesheet&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;link href=&#34;https://fonts.googleapis.com/css?family=Titillium+Web:700,900&#34; rel=&#34;stylesheet&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;link href=&#34;https://fonts.googleapis.com/css?family=Noto+Sans+TC&amp;display=swap&#34; rel=&#34;stylesheet&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;style&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            * {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                -webkit-box-sizing: border-box;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                box-sizing: border-box;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            body {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                padding: 0;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                margin: 0;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            #notfound {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                position: relative;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                height: 100vh;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            #notfound .notfound {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                position: absolute;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                left: 50%;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                top: 50%;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                -webkit-transform: translate(-50%, -50%);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                -ms-transform: translate(-50%, -50%);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                transform: translate(-50%, -50%);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            .notfound {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                max-width: 767px;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                width: 100%;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                line-height: 1.4;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                padding: 0px 15px;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            .notfound .notfound-404 {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                position: relative;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                height: 150px;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                line-height: 150px;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                margin-bottom: 25px;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            .notfound .notfound-404 h1 {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                font-family: &#39;Titillium Web&#39;, sans-serif;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                font-size: 186px;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                font-weight: 900;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                margin: 0px;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                text-transform: uppercase;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                background: url(&#39;https://static.yiy.tw/media/assect/text.png&#39;);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                -webkit-background-clip: text;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                -webkit-text-fill-color: transparent;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                background-size: cover;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                background-position: center;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            .notfound h2 {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                font-family: &#39;Noto Sans TC&#39;, sans-serif;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                font-size: 26px;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                font-weight: 700;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                margin: 0;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            .notfound p {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                font-family: &#39;Noto Sans TC&#39;, sans-serif;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                font-size: 14px;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                font-weight: 500;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                margin-bottom: 0px;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                text-transform: uppercase;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            .notfound a {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                font-family: &#39;Noto Sans TC&#39;, sans-serif;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                display: inline-block;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                text-transform: uppercase;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                color: #fff;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                text-decoration: none;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                border: none;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                background: #5c91fe;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                padding: 10px 40px;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                font-size: 14px;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                font-weight: 700;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                border-radius: 1px;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                margin-top: 15px;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                -webkit-transition: 0.2s all;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                transition: 0.2s all;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            .notfound a:hover {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                opacity: 0.8;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            @media only screen and (max-width: 767px) {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                .notfound .notfound-404 {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    height: 110px;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    line-height: 110px;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                .notfound .notfound-404 h1 {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    font-size: 120px;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;/style&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;/head&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;div id=&#34;notfound&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;div class=&#34;notfound&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;div class=&#34;notfound-404&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &lt;h1&gt;404&lt;/h1&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;h2&gt;糟糕! 我們好像找不到檔案或頁面！&lt;/h2&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;p&gt;抱歉，您要查找的檔案或頁面不存在，可能被刪除或是暫時不可使用&lt;/p&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;a href=&#34;https://steveyi.net/&#34;&gt;回到主頁&lt;/a&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;/html&gt;`</span>, {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;content-type&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;text/html;charset=UTF-8&#39;</span>,
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>status</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>404</span>
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>waitUntil</span>(<span style=color:#a6e22e>cache</span>.<span style=color:#a6e22e>put</span>(<span style=color:#a6e22e>url</span>, <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>clone</span>()));
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>response</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=refence>Refence:<a hidden class=anchor aria-hidden=true href=#refence>#</a></h1><ol><li><a href=https://jross.me/free-personal-image-hosting-with-backblaze-b2-and-cloudflare-workers/>Using Backblaze B2 and Cloudflare Workers for free image hosting</a></li><li><a href=https://www.cloudflare.com/bandwidth-alliance/backblaze/>Bandwidth Alliance | BACKBLAZE</a></li><li><a href=https://www.backblaze.com/blog/backblaze-and-cloudflare-partner-to-provide-free-data-transfer/>Backblaze and Cloudflare Partner to Provide Free Data Transfer</a></li></ol></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.steveyi.net/tags/%E4%BC%BA%E6%9C%8D%E5%99%A8/>伺服器</a></li><li><a href=https://blog.steveyi.net/tags/%E7%B6%B2%E7%AB%99%E6%97%A5%E8%AA%8C/>網站日誌</a></li><li><a href=https://blog.steveyi.net/tags/cdn/>CDN</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://blog.steveyi.net/>小易的部落格</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>