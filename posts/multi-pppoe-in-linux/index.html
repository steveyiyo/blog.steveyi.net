<!doctype html><html lang=tw dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>在 Linux 上實現虛擬 WAN 多撥 PPPoE | 小易的部落格</title><meta name=keywords content="網路"><meta name=description content="I've been using Linux as a router for quite some time."><meta name=author content="SteveYi"><link rel=canonical href=https://blog.steveyi.net/posts/multi-pppoe-in-linux/><link crossorigin=anonymous href=/assets/css/stylesheet.bccfefac377bc340f06c260aed1bddf49a4354816d7c570d6aac75a997986c95.css integrity="sha256-vM/vrDd7w0DwbCYK7Rvd9JpDVIFtfFcNaqx1qZeYbJU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.steveyi.net/images/me.png><link rel=icon type=image/png sizes=16x16 href=https://blog.steveyi.net/images/me.png><link rel=icon type=image/png sizes=32x32 href=https://blog.steveyi.net/images/me.png><link rel=apple-touch-icon href=https://blog.steveyi.net/images/me.png><link rel=mask-icon href=https://blog.steveyi.net/images/me.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.steveyi.net/en/posts/multi-pppoe-in-linux/><link rel=alternate hreflang=tw href=https://blog.steveyi.net/posts/multi-pppoe-in-linux/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-CPGWT2M3VT"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-CPGWT2M3VT",{anonymize_ip:!1})}</script><meta property="og:title" content="在 Linux 上實現虛擬 WAN 多撥 PPPoE"><meta property="og:description" content="I've been using Linux as a router for quite some time."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.steveyi.net/posts/multi-pppoe-in-linux/"><meta property="og:image" content="https://blog.steveyi.net/images/banner.webp"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-07-19T08:47:55+08:00"><meta property="article:modified_time" content="2021-07-19T08:47:55+08:00"><meta property="og:site_name" content="SteveYi's Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.steveyi.net/images/banner.webp"><meta name=twitter:title content="在 Linux 上實現虛擬 WAN 多撥 PPPoE"><meta name=twitter:description content="I've been using Linux as a router for quite some time."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.steveyi.net/posts/"},{"@type":"ListItem","position":2,"name":"在 Linux 上實現虛擬 WAN 多撥 PPPoE","item":"https://blog.steveyi.net/posts/multi-pppoe-in-linux/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"在 Linux 上實現虛擬 WAN 多撥 PPPoE","name":"在 Linux 上實現虛擬 WAN 多撥 PPPoE","description":"I've been using Linux as a router for quite some time.","keywords":["網路"],"articleBody":"前幾天，剛好想起來家中網路的 ISP（中華電信），可以透過撥號取得 7 個浮動的 Public IPv4 Address，於是就來實現他了！\n環境 以下資訊是透過 bench.sh 的 Script 所產生的\n---------------------------------------------------------------------- CPU Model : Intel(R) Celeron(R) CPU 3865U @ 1.80GHz CPU Cores : 2 CPU Frequency : 1278.526 MHz CPU Cache : 2048 KB Total Disk : 14.9 GB (6.6 GB Used) Total Mem : 1910 MB (256 MB Used) Total Swap : 2047 MB (0 MB Used) System uptime : 3 days, 18 hour 30 min Load average : 0.07, 0.06, 0.01 OS : Ubuntu 20.04.1 LTS Arch : x86_64 (64 Bit) Kernel : 5.4.0-77-generic TCP CC : cubic Virtualization : Dedicated Organization : AS3462 Data Communication Business Group Location : Chang-hua / TW Region : Taiwan ---------------------------------------------------------------------- 建立虛擬網卡 首先，我們需要先建立幾個虛擬 WAN，其 MacAddress 會不同。\n這些是我們等等使用 PPPoe 連線需要使用到的。\nenp1s0 為接上中華電信路由器的網卡，name 後可以自定義 這邊先建立 7 個虛擬網卡\nip link add link enp1s0 name wan0 type macvlan ip link add link enp1s0 name wan1 type macvlan ip link add link enp1s0 name wan2 type macvlan ip link add link enp1s0 name wan3 type macvlan ip link add link enp1s0 name wan4 type macvlan ip link add link enp1s0 name wan5 type macvlan ip link add link enp1s0 name wan6 type macvlan 設定 PPPoe 連線 我在 Linux 中使用 pppoeconf。\n如果沒有裝的話，可以透過以下指令安裝一下。\nsudo apt install pppoeconf 我們先進入 pppoeconf，將帳號密碼輸入進去。\n接著，再進去 /etc/ppp/peers 資料夾，將 dsl-provider 文件複製為其他檔案。\n並修改複製後檔案中的網卡名稱（ex: nic-wan1 -\u003e nic-wan0）\n接著，使用指令 pon \u003c檔案名稱\u003e 來啟用 PPPoe 連線。\n再下 ip addr 就可以看到網卡列表。\n這樣就大功告成囉！\n","wordCount":"223","inLanguage":"tw","datePublished":"2021-07-19T08:47:55+08:00","dateModified":"2021-07-19T08:47:55+08:00","author":{"@type":"Person","name":"SteveYi"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.steveyi.net/posts/multi-pppoe-in-linux/"},"publisher":{"@type":"Organization","name":"小易的部落格","logo":{"@type":"ImageObject","url":"https://blog.steveyi.net/images/me.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.steveyi.net/ accesskey=h title="小易的部落格 (Alt + H)">小易的部落格</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://blog.steveyi.net/en/ title=English aria-label=English>En</a></li></ul></div></div><ul id=menu><li><a href=https://blog.steveyi.net/ title=首頁><span>首頁</span></a></li><li><a href=https://blog.steveyi.net/posts/ title=文章列表><span>文章列表</span></a></li><li><a href=https://steveyi.net/zh-tw/ title=關於小易><span>關於小易</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://x.com/steveyiyo title="X (Twitter)"><span>X (Twitter)</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>在 Linux 上實現虛擬 WAN 多撥 PPPoE</h1><div class=post-description>I've been using Linux as a router for quite some time.</div><div class=post-meta><span title='2021-07-19 08:47:55 +0800 +0800'>July 19, 2021</span>&nbsp;·&nbsp;SteveYi&nbsp;|&nbsp;Translations:<ul class=i18n_list><li><a href=https://blog.steveyi.net/en/posts/multi-pppoe-in-linux/>En</a></li></ul></div></header><div class=post-content><p>前幾天，剛好想起來家中網路的 ISP（中華電信），可以透過撥號取得 7 個浮動的 Public IPv4 Address，於是就來實現他了！</p><h2 id=環境>環境<a hidden class=anchor aria-hidden=true href=#環境>#</a></h2><blockquote><p>以下資訊是透過 <a href=https://bench.sh>bench.sh</a> 的 Script 所產生的</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>----------------------------------------------------------------------
</span></span><span style=display:flex><span> CPU Model             : Intel<span style=color:#f92672>(</span>R<span style=color:#f92672>)</span> Celeron<span style=color:#f92672>(</span>R<span style=color:#f92672>)</span> CPU 3865U @ 1.80GHz
</span></span><span style=display:flex><span> CPU Cores             : <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span> CPU Frequency         : 1278.526 MHz
</span></span><span style=display:flex><span> CPU Cache             : <span style=color:#ae81ff>2048</span> KB
</span></span><span style=display:flex><span> Total Disk            : 14.9 GB <span style=color:#f92672>(</span>6.6 GB Used<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span> Total Mem             : <span style=color:#ae81ff>1910</span> MB <span style=color:#f92672>(</span><span style=color:#ae81ff>256</span> MB Used<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span> Total Swap            : <span style=color:#ae81ff>2047</span> MB <span style=color:#f92672>(</span><span style=color:#ae81ff>0</span> MB Used<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span> System uptime         : <span style=color:#ae81ff>3</span> days, <span style=color:#ae81ff>18</span> hour <span style=color:#ae81ff>30</span> min
</span></span><span style=display:flex><span> Load average          : 0.07, 0.06, 0.01
</span></span><span style=display:flex><span> OS                    : Ubuntu 20.04.1 LTS
</span></span><span style=display:flex><span> Arch                  : x86_64 <span style=color:#f92672>(</span><span style=color:#ae81ff>64</span> Bit<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span> Kernel                : 5.4.0-77-generic
</span></span><span style=display:flex><span> TCP CC                : cubic
</span></span><span style=display:flex><span> Virtualization        : Dedicated
</span></span><span style=display:flex><span> Organization          : AS3462 Data Communication Business Group
</span></span><span style=display:flex><span> Location              : Chang-hua / TW
</span></span><span style=display:flex><span> Region                : Taiwan
</span></span><span style=display:flex><span>----------------------------------------------------------------------
</span></span></code></pre></div><h2 id=建立虛擬網卡>建立虛擬網卡<a hidden class=anchor aria-hidden=true href=#建立虛擬網卡>#</a></h2><p>首先，我們需要先建立幾個虛擬 WAN，其 MacAddress 會不同。<br>這些是我們等等使用 PPPoe 連線需要使用到的。</p><ul><li>enp1s0 為接上中華電信路由器的網卡，name 後可以自定義</li></ul><blockquote><p>這邊先建立 7 個虛擬網卡</p></blockquote><pre tabindex=0><code>ip link add link enp1s0 name wan0 type macvlan
ip link add link enp1s0 name wan1 type macvlan
ip link add link enp1s0 name wan2 type macvlan
ip link add link enp1s0 name wan3 type macvlan
ip link add link enp1s0 name wan4 type macvlan
ip link add link enp1s0 name wan5 type macvlan
ip link add link enp1s0 name wan6 type macvlan
</code></pre><h2 id=設定-pppoe-連線>設定 PPPoe 連線<a hidden class=anchor aria-hidden=true href=#設定-pppoe-連線>#</a></h2><blockquote><p>我在 Linux 中使用 pppoeconf。<br>如果沒有裝的話，可以透過以下指令安裝一下。</p></blockquote><pre tabindex=0><code>sudo apt install pppoeconf
</code></pre><p>我們先進入 pppoeconf，將帳號密碼輸入進去。</p><p>接著，再進去 <code>/etc/ppp/peers</code> 資料夾，將 dsl-provider 文件複製為其他檔案。<br>並修改複製後檔案中的網卡名稱（ex: nic-wan1 -> nic-wan0）</p><p><img loading=lazy src=https://i.imgur.com/06M8VBv.png alt></p><p>接著，使用指令 <code>pon &lt;檔案名稱></code> 來啟用 PPPoe 連線。<br>再下 <code>ip addr</code> 就可以看到網卡列表。</p><p><img loading=lazy src=https://i.imgur.com/yg6Tx59.png alt></p><p>這樣就大功告成囉！</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.steveyi.net/tags/%E7%B6%B2%E8%B7%AF/>網路</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://blog.steveyi.net/>小易的部落格</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>